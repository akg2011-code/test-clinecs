import{r as j,t as I,j as e,B as l,T as S,N as P,O as _,v as M,P as v,w as B,U as w,H as T,E as H,J as N}from"./index-DLnjnVCu.js";import{u as R}from"./SettingData-5sbMzAiY.js";import{i as U}from"./image-BEsbZakN.js";import{k as q,F as Q}from"./index-DscDBtoO.js";import{a as $,I as k}from"./index-CrveBHTj.js";import{i as J,u as V,M as W,b as Y,a as G,c as K,h as X,d as Z,F as ee,e as se,f as p,g as b,L as te}from"./index.esm-CU9MGMRa.js";import{D as z}from"./index-Q7d3q0Zt.js";import{b as ie,I as L,F as A}from"./utils-DHjTyQ2S.js";import{V as ne}from"./Dashboard-BVf00d6b.js";import{U as ae,D as re}from"./DeletePatientFile-ALgrFW-j.js";import{O as oe,a as le}from"./chunk-46CXQZ4E-BT9pxOQy.js";function de({isOpen:d,onClose:r,id:c}){const[g,m]=j.useState(),[u,n]=j.useState(null),x=j.useRef(),{register:F,handleSubmit:h,reset:C}=J(),D=I(),a=V(),o=5*1024*1024,y=i=>{i.preventDefault();const s=i.dataTransfer.files[0];s&&s.size>o?p(a,"error","Please select a file smaller than 5 MB."):n(s)},t=i=>{i.preventDefault()},O=i=>{const s=i.target.files[0];s&&s.size>o?p(a,"error","Please select a file smaller than 5 MB."):n(s)},E=async i=>{let s={...i,patient_id:c,file:u};try{m(!0);const f=await v(B.token,"add_patient_file",s);m(!1),f.response===200?(p(a,"success","File Added!"),D.invalidateQueries(["patient-files",c]),n(null),C(),r()):p(a,"error",f.message)}catch(f){m(!1),p(a,"error",JSON.stringify(f))}};return e.jsxs(W,{isOpen:d,onClose:r,isCentered:!0,size:"lg",children:[e.jsx(Y,{}),e.jsxs(G,{as:"form",onSubmit:h(E),children:[e.jsx(K,{fontSize:18,py:2,children:"Add Patient Files"}),e.jsx(X,{}),e.jsx(z,{}),e.jsx(Z,{children:e.jsxs(l,{pb:3,children:[e.jsxs(ie,{isRequired:!0,children:[e.jsx(ee,{children:"Name"}),e.jsx(L,{placeholder:"Name",...F("file_name",{required:!0})})]}),e.jsx(l,{mt:5,p:4,border:"2px dashed",borderColor:"gray.300",borderRadius:"md",onDrop:y,onDragOver:t,onClick:()=>{x.current&&x.current.click()},cursor:"pointer",children:u?e.jsxs(l,{position:"relative",children:[e.jsxs(S,{children:["Selected File: ",u.name]}),e.jsx(P,{position:"absolute",right:-2,top:-2,size:"sm",onClick:()=>{n(null)}})]}):e.jsxs(l,{children:[e.jsxs(ne,{children:[" ",e.jsx(L,{ref:x,type:"file",onChange:O,accept:"*",mb:4})]}),e.jsxs(_,{children:[" ",e.jsx($,{fontSize:32})]}),e.jsxs(S,{textAlign:"center",mt:3,children:[e.jsx("b",{children:"Choose a file"})," or Drag it here.",e.jsx("br",{}),"Max 5 MB"]})]})})]})}),e.jsx(z,{}),e.jsxs(se,{py:3,children:[e.jsx(M,{colorScheme:"gray",mr:3,onClick:r,size:"sm",children:"Close"}),e.jsx(M,{variant:"solid",size:"sm",colorScheme:"blue",type:"submit",isLoading:g,children:"Add File"})]})]})]})}function De({id:d}){const[r,c]=j.useState(),{isOpen:g,onOpen:m,onClose:u}=b(),{isOpen:n,onOpen:x,onClose:F}=b(),{isOpen:h,onOpen:C,onClose:D}=b(),a=async()=>(await N(B.token,`get_patient_file/patient/${d}`)).data,{data:o,isLoading:y}=R({queryKey:["patient-files",d],queryFn:a});return y?e.jsx(w,{}):e.jsxs(l,{children:[e.jsxs(A,{alignItems:"center",justify:"space-between",children:[" ",e.jsxs(T,{as:"h3",size:"sm",children:["Files & Docs -"," "]}),e.jsx(M,{size:"xs",colorScheme:"blue",onClick:m,children:"Add New"})]}),e.jsx(z,{mt:2,mb:5}),e.jsx(l,{children:e.jsx(oe,{spacing:3,children:o==null?void 0:o.map((t,O)=>e.jsxs(le,{children:[e.jsxs(A,{alignItems:"center",gap:5,children:[e.jsx(te,{fontWeight:600,href:`${U}/${t.file}`,isExternal:!0,children:t.file_name}),e.jsx(k,{size:"xs",icon:e.jsx(q,{}),colorScheme:"blue",onClick:()=>{c(t),x()}})," ",e.jsx(k,{size:"xs",icon:e.jsx(Q,{}),colorScheme:"red",onClick:()=>{c(t),C()}})]}),e.jsxs(S,{fontSize:"xs",fontWeight:600,children:["Updated on -"," ",H(t.updated_at).format("DD-MM-YY HH:mm A"),")"]})]},O))})}),e.jsx(de,{isOpen:g,onClose:u,id:d}),n?e.jsx(ae,{isOpen:n,onClose:F,data:r}):null,h?e.jsx(re,{isOpen:h,onClose:D,data:r}):null]})}export{De as P};
