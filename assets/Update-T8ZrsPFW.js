import{r as T,j as e,B as x,G as de,F as me,J as E,w as D,E as M,L as R,t as X,U as Z,T as V,v,av as F,C as y,ax as Ie,Q as We,H as se}from"./index-DLnjnVCu.js";import{h as qe}from"./index-DoPvV33R.js";import{u as Me,B as Qe,k as Ve,j as fe}from"./HasPermission-Efb43n4z.js";import{u as $}from"./SettingData-5sbMzAiY.js";import{u as Y}from"./useMutation-CH8xzEHB.js";import{u as B,M as Re,b as he,a as Oe,c as ue,h as Te,d as xe,e as pe,f as C,g as ne,L as K,i as Le,F as P}from"./index.esm-CU9MGMRa.js";import{S as l,D as je,k as Ue,l as He,g as ae,c as Ce,d as Pe,e as W,f as ze,h as q,A as Ee,a as $e}from"./Dashboard-BVf00d6b.js";import{g as ye}from"./CancellationReqBadge-ClDtE-KR.js";import{u as ge}from"./UseSearchFilter-CSdYpLEl.js";import{T as we,p as Ke}from"./printPDF-B0J1mAQL.js";import{F as u,I as A,b as z}from"./utils-DHjTyQ2S.js";import{I as J,A as Ge}from"./index-CrveBHTj.js";import{B as L}from"./chunk-Z6RXEUPO-CjATnNZs.js";import{S as Je,a as Xe,b as Ze,C as oe}from"./swiper-react-DUABaiBA.js";import{D as G}from"./index-Q7d3q0Zt.js";import{H as et}from"./index-Cfx1qhVP.js";import{h as tt,i as st,j as nt}from"./index-DscDBtoO.js";import{d as Ae}from"./index-DR00hrC4.js";import{M as ce,a as le,b as be,c as ve}from"./chunk-Z3VR2BFQ-Dh96I6nM.js";import{T as at,a as it,b as _e,c as H,d as rt,e as Q}from"./chunk-MGVPL3OH-BhiF1P3g.js";import{P as ot}from"./PatientFiles-DHYo4lin.js";import{C as ie,a as re}from"./chunk-YQO7BFFX-DeFCmj0r.js";import{S as ct}from"./chunk-3RSXBRAN-DjkGz0-1.js";import"./image-BEsbZakN.js";import"./chunk-JARCRF6W-CtmXHheL.js";import"./DeletePatientFile-ALgrFW-j.js";import"./chunk-46CXQZ4E-BT9pxOQy.js";function lt({appointmentID:s}){const[n,a]=T.useState(),i=B(),r="Errortoast",d=async()=>{const _=await E(D.token,`get_invoice/appointment/${s}`),S=_.data;return _.data===null?[]:[{id:S.id,status:S.status,totalAmount:S.total_amount,applied_coupon:S.coupon_title||"N/A","coupon value (%)":S.coupon_value||"N/A",coupon_off_amount:S.coupon_off_amount||0,Date:M(S.invoice_date).format("D MMM YY"),patientID:e.jsx(R,{to:`/patient/${S.patient_id}`,children:S.patient_id}),appointmentID:e.jsx(R,{to:`/appointment/${S.appointment_id}`,children:S.appointment_id}),createdAt:M(S.created_at).format("D MMM YY hh:mmA"),paymentID:S.payment_id}]},p=_=>{a(_)},{isLoading:j,data:f,error:m}=$({queryKey:["invoice",s],queryFn:d}),{handleSearchChange:k,filteredData:c}=ge(f);return m&&(i.isActive(r)||i({id:r,title:"oops!.",description:"Something bad happens.",status:"error",duration:2e3,isClosable:!0,position:"top"})),e.jsx(x,{children:j||!f?e.jsxs(x,{children:[e.jsxs(u,{mb:5,justify:"space-between",children:[e.jsx(l,{w:400,h:8}),e.jsx(l,{w:50,h:8})]}),e.jsx(l,{h:300,w:"100%"})]}):e.jsxs(x,{children:[e.jsx(u,{mb:5,justify:"space-between",align:"center",children:e.jsx(A,{size:"md",placeholder:"Search",w:400,maxW:"50vw",onChange:_=>k(_.target.value)})}),e.jsx(je,{data:c,onActionClick:e.jsx(dt,{rowData:n,onClick:p})})]})})}const dt=({onClick:s,rowData:n})=>{const a=i=>{const r=window.open(i,"_blank");r&&(r.focus(),r.onload=()=>{r.load(),r.onafterprint=()=>{r.close()}})};return e.jsx(u,{justify:"center",children:e.jsx(J,{size:"sm",variant:"ghost",_hover:{background:"none"},onClick:()=>{s(n),a(`${de}/invoice/generatePDF/${n.id}`)},icon:e.jsx(we,{fontSize:18,color:me.colors.blue[500]})})})},mt=s=>{switch(s){case"Credited":return e.jsx(L,{colorScheme:"green",fontSize:12,letterSpacing:.5,p:"5px",size:"sm",children:"Credited"});case"Debited":return e.jsx(L,{colorScheme:"red",fontSize:12,letterSpacing:.5,p:"5px",children:"Debited"});default:return e.jsx(L,{colorScheme:"yellow",fontSize:12,letterSpacing:.5,p:"5px",children:"N/A"})}};function ht({appointmentID:s}){const[n,a]=T.useState(),i=B(),r="Errortoast",d=async()=>{const _=await E(D.token,`get_all_transaction/appointment/${s}`);return _==null?void 0:_.data.map(I=>{const{id:o,user_id:g,patient_id:h,appointment_id:w,payment_transaction_id:t,amount:N,transaction_type:O,is_wallet_txn:U,notes:ee,created_at:b,patient_f_name:te,patient_l_name:Fe,user_f_name:Be,user_l_name:Ne}=I;return{id:o,patient:e.jsx(R,{to:`/patient/${h}`,children:`${te} ${Fe}`}),user:g?e.jsx(R,{to:`/user/${g}`,children:`${Be} ${Ne}`}):"N/A",app_ID:e.jsx(R,{to:`/appointment/${w}`,children:w}),txn_ID:t||"N/A",amount:N,txn_type:mt(O),wallet_Txn:U==1?"Yes":"No",notes:ee||"N/A",createdAt:M(b).format("D MMM YY hh:mmA")}})},p=_=>{a(_)},{isLoading:j,data:f,error:m}=$({queryKey:["transaction",s],queryFn:d}),{handleSearchChange:k,filteredData:c}=ge(f);return m&&(i.isActive(r)||i({id:r,title:"oops!.",description:"Something bad happens.",status:"error",duration:2e3,isClosable:!0,position:"top"})),e.jsx(x,{children:j||!f?e.jsxs(x,{children:[e.jsxs(u,{mb:5,justify:"space-between",children:[e.jsx(l,{w:400,h:8}),e.jsx(l,{w:50,h:8})]}),e.jsx(l,{h:300,w:"100%"})]}):e.jsxs(x,{children:[e.jsx(u,{mb:5,justify:"space-between",align:"center",children:e.jsx(A,{size:"md",placeholder:"Search",w:400,maxW:"50vw",onChange:_=>k(_.target.value)})}),e.jsx(je,{data:c,onActionClick:e.jsx(ut,{rowData:n,onClick:p})})]})})}const ut=({onClick:s,rowData:n})=>e.jsx(u,{justify:"center",children:e.jsx(J,{size:"sm",variant:"ghost",_hover:{background:"none"},onClick:()=>{s(n)},icon:e.jsx(we,{fontSize:18,color:me.colors.blue[500]})})});function xt({appointmentID:s}){const[n,a]=T.useState(),i=async()=>{const m=await E(D.token,`get_appointment_payment/appintment/${s}`);return m.data===null?[]:(c=>{const{id:_,txn_id:S,invoice_id:I,amount:o,payment_time_stamp:g,payment_method:h,created_at:w,user_id:t,patient_id:N,appointment_id:O,patient_f_name:U,patient_l_name:ee,user_f_name:b,user_l_name:te}=c;return[{id:_,"txn ID":S,invoiceID:I,patient:e.jsx(R,{to:`/patient/${N}`,children:`${U} ${ee}`}),user:e.jsx(R,{to:`/user/${t}`,children:`${b} ${te}`}),"APP ID":e.jsx(R,{to:`/appointment/${O}`,children:O}),amount:o,"payment Method":h,"Time stamp":M(g).format("D MMM YY hh.mmA"),"created At":M(w).format("D MMM YY hh:mmA")}]})(m.data)},r=m=>{a(m)},{isLoading:d,data:p}=$({queryKey:["payment",s],queryFn:i}),{handleSearchChange:j,filteredData:f}=ge(p);return e.jsx(x,{children:d||!p?e.jsxs(x,{children:[e.jsxs(u,{mb:5,justify:"space-between",children:[e.jsx(l,{w:400,h:8}),e.jsx(l,{w:50,h:8})]}),e.jsx(l,{h:300,w:"100%"})]}):e.jsxs(x,{children:[e.jsx(u,{mb:5,justify:"space-between",align:"center",children:e.jsx(A,{size:"md",placeholder:"Search",w:400,maxW:"50vw",onChange:m=>j(m.target.value)})}),e.jsx(je,{data:f,onActionClick:e.jsx(pt,{rowData:n,onClick:r})})]})})}const pt=({onClick:s,rowData:n})=>e.jsx(u,{justify:"center",children:e.jsx(J,{size:"sm",variant:"ghost",_hover:{background:"none"},onClick:()=>{s(n),Ke(`${de}/invoice/generatePDF/${n.invoiceID}`)},icon:e.jsx(we,{fontSize:18,color:me.colors.blue[500]})})}),jt=()=>{const s=[];for(let n=0;n<15;n++){const a=M().add(n,"days").format("YYYY-MM-DD");s.push(a)}return s},Se=s=>{const n=M(s,"YYYY-MM-DD");return{month:n.format("MMM"),date:n.format("DD"),year:n.format("ddd")}},gt=s=>M(s,"YYYYMMDD").format("dddd"),ft={spaceBetween:20,centeredSlides:!1,loop:!1,slidesPerView:7.5,breakpoints:{1024:{spaceBetween:5,slidesPerView:7.5},768:{spaceBetween:5,slidesPerView:6.5},640:{spaceBetween:5,slidesPerView:5.5},320:{spaceBetween:5,slidesPerView:5.5}}},yt=async s=>{const n=await F(D.token,"appointment_rescheduled",s);if(n.response!==200)throw new Error(n.message);return n};function _t({data:s,isOpen:n,onClose:a}){const[i,r]=T.useState(),[d,p]=T.useState(),j=X(),f=B(),m=async()=>(await E(D.token,`get_doctor_time_interval/${s.doct_id}/${gt(i)}`)).data,{isLoading:k,data:c}=$({queryKey:["timeslotes",i,s.doct_id],queryFn:m,enabled:!!i}),_=async()=>(await E(D.token,`get_booked_time_slots?doct_id=${s.doct_id}&date=${M(i).format("YYYY-MM-DD")}&type=OPD`)).data,{isLoading:S,data:I}=$({queryKey:["bookedslotes",i,s.doct_id],queryFn:_,enabled:!!i,staleTime:0,cacheTime:0,refetchOnWindowFocus:!0,refetchOnReconnect:!0}),o=h=>{let w=!0;return I==null||I.forEach(t=>{t.time_slots===h.time_start&&t.date===i&&(w=!1)}),w},g=Y({mutationFn:async()=>{let h={id:s.id,date:i,time_slots:d.time_start};await yt(h)},onSuccess:()=>{r(),p(),C(f,"success","Success"),j.invalidateQueries("appointments"),j.invalidateQueries(["appointment",s.id]),j.invalidateQueries(["bookedslotes",i,s.doct_id]),j.invalidateQueries(["timeslotes",i,s.doct_id]),a()},onError:h=>{C(f,"error",h.message)}});return k||S||g.isPending?e.jsx(Z,{}):e.jsxs(Re,{isOpen:n,onClose:a,isCentered:!0,size:"xl",children:[e.jsx(he,{}),e.jsxs(Oe,{children:[e.jsx(ue,{fontSize:"md",py:3,children:"Reschedule Appointment"}),e.jsx(Te,{top:2}),e.jsx(G,{mt:0}),e.jsxs(xe,{children:[e.jsxs(x,{maxW:"100%",overflow:"hidden",children:[" ",e.jsx(Je,{...ft,style:{cursor:"grab",overflow:"hidden",maxWidth:"100%"},children:jt().map((h,w)=>e.jsx(Xe,{children:e.jsx(x,{onClick:()=>{r(M(h).format("YYYY-MM-DD"))},children:e.jsxs(x,{bg:i===M(h).format("YYYY-MM-DD")?"green.500":"blue.500",mr:3,borderRadius:5,color:"#fff",p:1,cursor:"pointer",children:[e.jsx(V,{fontSize:"xs",fontWeight:"bold",color:"gray.100",textAlign:"center",m:0,children:Se(h).month}),e.jsx(V,{fontSize:"sm",fontWeight:"700",color:"gray.100",textAlign:"center",m:0,children:Se(h).date}),e.jsx(V,{fontSize:"xs",fontWeight:"bold",color:"gray.100",textAlign:"center",m:0,children:Se(h).year})]})},w)},w))})]}),e.jsx(x,{children:i?e.jsxs(x,{mt:5,border:"1px solid",borderColor:"gray.200",p:2,borderRadius:4,children:[e.jsx(V,{textAlign:"left",fontWeight:600,fontSize:16,mb:1,children:"Time Slotes"}),c!=null&&c.length?e.jsx(x,{mt:2,children:e.jsx(Ze,{columns:[3,4,5],spacing:2,children:c==null?void 0:c.map((h,w)=>e.jsxs(v,{size:"sm",fontSize:"xs",fontWeight:600,colorScheme:o(h)?h===d?"blue":"green":"red",variant:"solid",onClick:()=>{o(h)&&p(h)},isDisabled:!o(h),_disabled:{backgroundColor:"red.500"},children:[h.time_start," - ",h.time_end]},w))})}):e.jsx(V,{color:"red.400",fontWeight:700,fontSize:"sm",children:"Sorry , no available time slotes ware found for the selected date."})]}):""})]}),e.jsxs(pe,{children:[e.jsx(v,{colorScheme:"gray",mr:3,onClick:a,size:"sm",children:"Close"}),e.jsx(v,{colorScheme:"blue",size:"sm",onClick:()=>{g.mutate()},children:"Reschedule Appointment"})]})]})]})}const St=[{id:1,name:"Cash",icon:e.jsx(tt,{})},{id:2,name:"Online",icon:e.jsx(Ae,{})},{id:3,name:"Other",icon:e.jsx(Ae,{})},{id:4,name:"Wallet",icon:e.jsx(st,{})},{id:5,name:"UPI",icon:e.jsx(et,{})}],wt=async s=>{const n=await F(D.token,"update_appointment_to_paid",s);if(n.response!==200)throw new Error(n.message);return n};function bt({id:s,isOpen:n,onClose:a}){const[i,r]=T.useState(),d=B(),p=X(),j=Y({mutationFn:async()=>{let f={appointment_id:s,payment_method:i.name};i?wt(f):C(d,"error","Please Select Payment Mode")},onSuccess:()=>{C(d,"success","Success"),p.invalidateQueries("appointments"),p.invalidateQueries(["appointment",s]),p.invalidateQueries(["payment",s]),p.invalidateQueries(["transaction",s]),p.invalidateQueries(["invoice",s]),a()}});return j.isPending?e.jsx(Z,{}):e.jsxs(Re,{isOpen:n,onClose:a,isCentered:!0,size:"sm",children:[e.jsx(he,{}),e.jsxs(Oe,{children:[e.jsx(ue,{fontSize:"md",py:3,children:"Amount Paid"}),e.jsx(Te,{top:2}),e.jsx(G,{mt:0}),e.jsx(xe,{children:e.jsxs(ce,{children:[e.jsx(le,{as:v,rightIcon:e.jsx(oe,{}),w:"full",bg:"transparent",textAlign:"center",pl:0,pt:0,h:8,_hover:{bg:"transparent"},_focus:{bg:"transparent"},borderBottom:"1px solid",borderBottomRadius:0,borderColor:y("gray.200","gray.600"),children:i?e.jsxs(u,{gap:3,align:"center",children:[" ",i.icon," ",i.name]}):"Select Payment Mode"}),e.jsx(be,{children:St.map(f=>e.jsx(ve,{onClick:()=>{r(f)},children:e.jsxs(u,{gap:3,align:"center",children:[" ",f.icon," ",f.name]})},f.id))})]})}),e.jsxs(pe,{children:[e.jsx(v,{colorScheme:"gray",mr:3,onClick:a,size:"sm",children:"Close"}),e.jsx(v,{colorScheme:"blue",size:"sm",onClick:()=>{j.mutate()},children:"Set Amount to Paid"})]})]})]})}function vt({appointmentID:s,appointmntData:n}){const{hasPermission:a}=Me(),[i,r]=T.useState(),{isOpen:d,onOpen:p,onClose:j}=ne(),f=async()=>(await E(D.token,`get_prescription/appointment/${s}`)).data,{isLoading:m,data:k,error:c}=$({queryKey:["prescriptions",s],queryFn:f}),{handleSearchChange:_,filteredData:S}=ge(k);if(c)return e.jsx(V,{color:"red.500",children:"Error loading data"});const I=o=>{const g=window.open(o,"_blank");g&&(g.focus(),g.onload=()=>{g.load(),g.onafterprint=()=>{g.close()}})};return e.jsxs(x,{children:[m?e.jsxs(x,{children:[e.jsxs(u,{mb:5,justify:"space-between",children:[e.jsx(l,{w:400,h:8}),e.jsx(l,{w:200,h:8})]}),e.jsx(l,{h:10,w:"100%",mt:2}),e.jsx(l,{h:10,w:"100%",mt:2}),e.jsx(l,{h:10,w:"100%",mt:2}),e.jsx(l,{h:10,w:"100%",mt:2}),e.jsx(l,{h:10,w:"100%",mt:2}),e.jsx(l,{h:10,w:"100%",mt:2}),e.jsx(l,{h:10,w:"100%",mt:2}),e.jsx(l,{h:10,w:"100%",mt:2}),e.jsx(l,{h:10,w:"100%",mt:2}),e.jsx(l,{h:10,w:"100%",mt:2})]}):e.jsxs(x,{p:5,children:[e.jsxs(u,{mb:4,alignItems:"center",justify:"space-between",children:[e.jsx(A,{placeholder:"Search",width:"300px",mr:2,icon:e.jsx(Ue,{}),onChange:o=>_(o.target.value),size:"sm"}),a("PRESCRIPTION_ADD")&&e.jsx(v,{colorScheme:"blue",size:"sm",as:R,to:`/add-prescription/?appointmentID=${s}&patientID=${n==null?void 0:n.patient_id}`,children:"New Prescription"})]}),e.jsx(x,{borderWidth:"1px",borderRadius:"lg",overflow:"scroll",maxW:"100%",children:e.jsxs(at,{variant:"simple",children:[e.jsx(it,{children:e.jsxs(_e,{children:[e.jsx(H,{children:"Patient"}),e.jsx(H,{children:"Doctor"}),e.jsx(H,{children:"Date"}),e.jsx(H,{children:"Pulse Rate"}),e.jsx(H,{children:"Temperature"}),e.jsx(H,{children:"Action"})]})}),e.jsx(rt,{children:k.length>0?S.map(o=>e.jsxs(_e,{children:[e.jsx(Q,{children:`${o.patient_f_name} ${o.patient_l_name}`}),e.jsx(Q,{children:`${n.doct_f_name} ${n.doct_l_name}`}),e.jsx(Q,{children:o.date}),e.jsx(Q,{children:o.pulse_rate}),e.jsx(Q,{children:o.temperature}),e.jsx(Q,{children:e.jsxs(u,{alignItems:"center",children:[" ",e.jsx(J,{as:K,"aria-label":"Filter",icon:e.jsx(Qe,{fontSize:22}),colorScheme:"whatsapp",size:"sm",variant:"ghost",target:"_blank",rel:"noopener noreferrer",onClick:()=>{I(`${de}/prescription/generatePDF/${o.id}`)}}),a("PRESCRIPTION_UPDATE")&&e.jsx(J,{as:R,"aria-label":"Filter",icon:e.jsx(Ge,{fontSize:24}),colorScheme:"blue",size:"sm",variant:"ghost",to:`/prescription/${o==null?void 0:o.id}/?appointmentID=${o==null?void 0:o.appointment_id}&patientID=${o==null?void 0:o.patient_id}`}),e.jsx(J,{"aria-label":"Filter",icon:e.jsx(Ve,{fontSize:20}),colorScheme:"red",size:"sm",variant:"ghost",onClick:()=>{p(),r(o)}})," "]})})]},o.id)):e.jsx(_e,{children:e.jsx(Q,{colSpan:"7",children:e.jsx(V,{align:"center",children:"No data available in table"})})})})]})})]}),d&&e.jsx(He,{isOpen:d,onClose:j,data:i})]})}let De=["Pending","Confirmed","Rejected","Visited"],Ct=["Pending","Confirmed","Rejected","Completed"];const Pt=s=>s==="OPD"?De:s==="Video Consultant"?Ct:De,zt=s=>{switch(s){case"Emergency":return e.jsx(L,{colorScheme:"red",p:"5px",px:10,children:s});case"OPD":return e.jsx(L,{colorScheme:"green",p:"5px",px:10,children:s});default:return e.jsx(L,{colorScheme:"green",p:"5px",px:10,children:s})}},At=async s=>{const n=await F(D.token,"update_appointment",s);if(n.response!==200)throw new Error(n.message);return n},Ye=async s=>{const n=await F(D.token,"update_appointment_status",s);if(n.response!==200)throw new Error(n.message);return n},Dt=async s=>{const n=await F(D.token,"appointment_reject_and_refund",s);if(n.response!==200)throw new Error(n.message);return n},kt=async s=>{const n=await F(D.token,"appointment_cancellation_and_refund",s);if(n.response!==200)throw new Error(n.message);return n};function os(){const{register:s,handleSubmit:n}=Le(),{id:a}=Ie(),i=B(),r=We(),d=X(),[p,j]=T.useState(null),{isOpen:f,onOpen:m,onClose:k}=ne(),{hasPermission:c}=Me(),{isOpen:_,onOpen:S,onClose:I}=ne(),{isOpen:o,onOpen:g,onClose:h}=ne(),w=async()=>{const b=await E(D.token,`get_appointment/${a}`);return j(b.data.status),b.data},{data:t,isLoading:N}=$({queryKey:["appointment",a],queryFn:w}),O=Y({mutationFn:async b=>{await At(b)},onSuccess:()=>{d.invalidateQueries("appointments"),d.invalidateQueries("main-appointments"),d.invalidateQueries(["appointment",a])},onError:b=>{C(i,"error",b.message)}}),U=Y({mutationFn:async b=>{await Ye(b)},onSuccess:()=>{d.invalidateQueries("appointments"),d.invalidateQueries("main-appointments"),d.invalidateQueries(["appointment",a])},onError:b=>{C(i,"error",b.message)}}),ee=b=>{O.mutate({...b,status:p})};return N||O.isPending||U.isPending?e.jsx(Z,{}):e.jsxs(x,{children:[" ",e.jsxs(u,{justify:"space-between",alignItems:"center",children:[e.jsxs(u,{justify:"space-between",alignItems:"center",gap:5,children:[e.jsxs(se,{as:"h1",size:"md",children:["Appointment Details #",a]}),ae(t==null?void 0:t.status),e.jsxs(L,{colorScheme:"gray",p:"5px",px:5,children:["Source - ",t.source]}),t.type==="Video Consultant"?t.meeting_link&&e.jsx(v,{rightIcon:e.jsx(qe,{}),size:"sm",variant:"outline",cursor:"pointer",as:K,href:t.meeting_link,isExternal:!0,color:"teal",children:"Join Meeting"}):null,e.jsx(v,{rightIcon:e.jsx(nt,{}),size:"sm",variant:"link",cursor:"pointer",as:K,href:`${de}/consultation_report/${a}`,isExternal:!0,children:"Print Consultation Report"})]}),e.jsx(v,{w:120,size:"sm",variant:y("blackButton","gray"),onClick:()=>{r(-1)},children:"Back"})]}),e.jsxs(Ce,{colorScheme:"blue",mt:3,children:[e.jsxs(Pe,{children:[e.jsx(W,{children:"Overview"}),c("PRESCRIPTION_VIEW")&&e.jsx(W,{children:"Prescriptions"}),c("APPOINTMENT_INVOICE_VIEW")&&e.jsx(W,{children:"Invoice"}),c("ALL_TRANSACTION_VIEW")&&e.jsx(W,{children:"Transaction"}),c("APPOINTMENT_PAYMENTS_VIEW")&&e.jsx(W,{children:"Payments"}),c("FILE_VIEW")&&e.jsx(W,{children:"Patient Files"})]}),e.jsxs(ze,{children:[e.jsx(q,{children:e.jsxs(x,{children:[e.jsxs("form",{onSubmit:n(ee),children:[e.jsxs(u,{gap:8,children:[e.jsxs(x,{w:"55%",children:[" ",e.jsx(ie,{mt:5,bg:y("white","gray.700"),children:e.jsxs(re,{p:3,as:"form",children:[" ",e.jsxs(u,{align:"center",gap:5,children:[" ",e.jsx(se,{as:"h3",size:"sm",children:"Patient Details"}),e.jsx(K,{to:`/patient/${t.patient_id}`,as:R,children:e.jsx(fe,{fontSize:20})})]}),e.jsx(G,{mt:2,mb:5}),e.jsxs(u,{gap:5,children:[e.jsxs(z,{children:[e.jsx(P,{fontSize:"sm",mb:0,color:y("gray.600","gray.300"),children:"Patient First Name"}),e.jsx(A,{size:"sm",isReadOnly:!0,fontWeight:600,variant:"flushed",defaultValue:t.patient_f_name})]}),e.jsxs(z,{children:[e.jsx(P,{fontSize:"sm",mb:0,color:y("gray.600","gray.300"),children:"Patient Last Name"}),e.jsx(A,{size:"sm",isReadOnly:!0,fontWeight:600,variant:"flushed",defaultValue:t.patient_l_name})]})]}),e.jsxs(u,{gap:5,mt:2,children:[e.jsxs(z,{id:"doct_specialization",size:"sm",children:[e.jsx(P,{fontSize:"sm",mb:0,color:y("gray.600","gray.300"),children:"Phone"}),e.jsx(A,{size:"sm",isReadOnly:!0,fontWeight:600,variant:"flushed",defaultValue:t.patient_phone})]}),e.jsxs(z,{id:"dept_title",size:"sm",children:[e.jsx(P,{fontSize:"sm",mb:0,color:y("gray.600","gray.300"),children:"Gender"}),e.jsx(A,{size:"sm",isReadOnly:!0,fontWeight:600,variant:"flushed",defaultValue:t.patient_gender})]})]})]})})]})," ",e.jsxs(x,{w:"45%",children:[" ",e.jsx(ie,{mt:5,bg:y("white","gray.700"),children:e.jsxs(re,{p:3,as:"form",children:[" ",e.jsxs(u,{alignItems:"center",gap:5,children:[e.jsxs(se,{as:"h3",size:"sm",children:["Doctor"," "]})," ",e.jsx(K,{to:`/doctor/${t.doct_id}`,as:R,children:e.jsx(fe,{fontSize:20})})]}),e.jsx(G,{mt:2,mb:5}),e.jsxs(u,{gap:5,children:[e.jsxs(z,{children:[e.jsx(P,{fontSize:"sm",mb:0,color:y("gray.600","gray.300"),children:"Doctor First Name"}),e.jsx(A,{size:"sm",isReadOnly:!0,fontWeight:600,variant:"flushed",defaultValue:t.doct_f_name})]}),e.jsxs(z,{children:[e.jsx(P,{fontSize:"sm",mb:0,color:y("gray.600","gray.300"),children:"Doctor Last Name"}),e.jsx(A,{size:"sm",isReadOnly:!0,fontWeight:600,variant:"flushed",defaultValue:t.doct_l_name})]})]}),e.jsxs(u,{gap:5,mt:2,children:[e.jsxs(z,{id:"doct_specialization",size:"sm",children:[e.jsx(P,{fontSize:"sm",mb:0,color:y("gray.600","gray.300"),children:"Doctor Specialization"}),e.jsx(A,{size:"sm",isReadOnly:!0,fontWeight:600,variant:"flushed",defaultValue:t.doct_specialization})]}),e.jsxs(z,{id:"dept_title",size:"sm",children:[e.jsx(P,{fontSize:"sm",mb:0,color:y("gray.600","gray.300"),children:"Department"}),e.jsx(A,{size:"sm",isReadOnly:!0,fontWeight:600,variant:"flushed",defaultValue:t.dept_title})]})]})]})})]})," "]}),e.jsxs(u,{gap:8,children:[e.jsxs(x,{w:"45%",children:[" ",e.jsx(ie,{mt:5,bg:y("white","gray.700"),children:e.jsxs(re,{p:3,as:"form",children:[" ",e.jsxs(se,{as:"h3",size:"sm",children:["Appointment Details -"," "]})," ",e.jsx(G,{mt:2,mb:5}),e.jsxs(u,{gap:5,children:[e.jsxs(z,{children:[e.jsx(P,{fontSize:"sm",mb:0,color:y("gray.600","gray.300"),children:"Appointment Date"}),e.jsx(A,{size:"sm",fontWeight:600,variant:"flushed",value:M(t==null?void 0:t.date).format("DD-MM-YYYY"),onClick:()=>{if((t==null?void 0:t.status)=="Confirmed"||(t==null?void 0:t.status)=="Pending"||(t==null?void 0:t.status)=="Rescheduled")S();else return},cursor:"pointer"})]}),e.jsxs(z,{children:[e.jsx(P,{fontSize:"sm",mb:0,color:y("gray.600","gray.300"),children:"Appointment Time Slot"}),e.jsx(A,{size:"sm",fontWeight:600,variant:"flushed",value:M(t==null?void 0:t.time_slots,"hh:mm:ss").format("hh:mm A"),onClick:()=>{if((t==null?void 0:t.status)=="Confirmed"||(t==null?void 0:t.status)=="Pending"||(t==null?void 0:t.status)=="Rescheduled")S();else return},cursor:"pointer"})]})]}),e.jsxs(u,{gap:5,mt:2,children:[e.jsxs(z,{id:"status",size:"sm",children:[e.jsx(P,{fontSize:"sm",mb:0,color:y("gray.600","gray.300"),children:"Status"}),e.jsxs(ce,{children:[e.jsx(le,{as:v,rightIcon:e.jsx(oe,{}),bg:"transparent",w:"100%",textAlign:"left",pl:0,pt:0,h:8,_hover:{bg:"transparent"},_focus:{bg:"transparent"},borderBottom:"1px solid",borderBottomRadius:0,borderColor:y("gray.200","gray.600"),children:p?ae(p):ae(t==null?void 0:t.status)}),["Pending","Confirmed","Rescheduled"].includes(t==null?void 0:t.status)&&e.jsx(be,{children:Pt(t.type).map(b=>e.jsx(ve,{onClick:()=>{if(t.current_cancel_req_status==="Initiated")return C(i,"error","Please Update the Cancellation request first");if(b==="Rejected")m();else{let te={id:a,status:b};U.mutate(te)}},children:e.jsx(x,{display:"flex",alignItems:"center",children:ae(b)})},b))})]})]}),e.jsxs(z,{id:"doct_specialization",size:"sm",children:[e.jsx(P,{fontSize:"sm",mb:0,color:y("gray.600","gray.300"),children:"Appointment Type"}),e.jsx(ce,{children:e.jsx(le,{as:v,rightIcon:e.jsx(oe,{}),bg:"transparent",w:"100%",textAlign:"left",pl:0,pt:0,h:8,_hover:{bg:"transparent"},_focus:{bg:"transparent"},borderBottom:"1px solid",borderBottomRadius:0,borderColor:y("gray.200","gray.600"),children:zt(t.type)})})]})]})]})})]})," ",e.jsxs(x,{w:"55%",children:[" ",e.jsx(ie,{mt:5,bg:y("white","gray.700"),children:e.jsxs(re,{p:3,as:"form",children:[" ",e.jsxs(se,{as:"h3",size:"sm",children:["Other -"," "]})," ",e.jsx(G,{mt:2,mb:5}),e.jsx(u,{gap:5,align:"flex-end",children:e.jsxs(z,{isRequired:!0,children:[e.jsx(P,{fontSize:"sm",mb:0,color:y("gray.600","gray.300"),children:"Payment Status"}),e.jsx(ct,{placeholder:"Select paymemnt status",variant:"flushed",value:t==null?void 0:t.payment_status,...s("payment_status"),isReadOnly:!0,onChange:b=>{if(b.target.value==="Paid")g();else return},children:["Pending","Not Paid","Unpaid"].includes(t.payment_status)||t.payment_status===null?e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"Paid",children:"Paid"}),e.jsx("option",{value:"Pending",children:"Pending"}),e.jsx("option",{value:"Not Paid",children:"Not Paid"}),e.jsx("option",{value:"Refunded",children:"Refunded"})]}):e.jsx(e.Fragment,{children:e.jsx("option",{value:t.payment_status,children:t.payment_status})})})]})}),e.jsxs(u,{gap:5,mt:2,children:[e.jsxs(z,{id:"doct_specialization",size:"sm",children:[e.jsx(P,{fontSize:"sm",mb:0,color:y("gray.600","gray.300"),children:"Meeting ID"}),e.jsx(A,{...s("meeting_id"),size:"sm",fontWeight:600,variant:"flushed",defaultValue:t.meeting_id})]}),e.jsxs(z,{id:"dept_title",size:"sm",children:[e.jsxs(P,{fontSize:"sm",mb:0,color:y("gray.600","gray.300"),display:"Flex",alignItems:"center",gap:2,children:["Meeting Link"," ",t.type==="Video Consultant"?t.meeting_link&&e.jsx(K,{href:t.meeting_link,target:"_blank",children:e.jsx(fe,{fontSize:20,color:me.colors.teal[500]})}):null]}),e.jsx(A,{...s("meeting_link"),size:"sm",fontWeight:600,variant:"flushed",value:t.meeting_link})]})]})]})})]})," "]})]}),e.jsxs(Ce,{mt:5,colorScheme:"red",children:[e.jsx(Pe,{children:e.jsx(W,{fontSize:18,fontWeight:600,children:"Cancellation Req By Patient"})}),e.jsx(ze,{children:e.jsx(q,{px:0,children:e.jsx(It,{current_req:t.current_cancel_req_status})})})]})]})}),c("PRESCRIPTION_VIEW")&&e.jsx(q,{children:e.jsx(vt,{appointmentID:a,appointmntData:t})}),c("APPOINTMENT_INVOICE_VIEW")&&e.jsx(q,{children:e.jsx(lt,{appointmentID:a})}),c("ALL_TRANSACTION_VIEW")&&e.jsx(q,{children:e.jsx(ht,{appointmentID:a})}),c("APPOINTMENT_PAYMENTS_VIEW")&&e.jsx(q,{children:e.jsx(xt,{appointmentID:a})}),e.jsx(q,{children:e.jsx(ot,{id:t.patient_id})})]})]}),e.jsx(Mt,{isOpen:f,onClose:k,id:a,appData:t}),e.jsx(_t,{data:t,isOpen:_,onClose:I}),e.jsx(bt,{id:a,isOpen:o,onClose:h})]})}function ke(s){switch(s){case"Initiated":return["Processing","Rejected","Approved"];case"Processing":return["Rejected","Approved"];case"Rejected":return[];case"Approved":return[];default:return[]}}const It=({current_req:s})=>{var I,o;const{id:n}=Ie(),a=B(),i=X(),{isOpen:r,onOpen:d,onClose:p}=ne(),[j,f]=T.useState(),m=async()=>{const g=await E(D.token,`get_appointment_cancel_req/appointment/${n}`);return(g==null?void 0:g.data.map(w=>{const{status:t,notes:N,created_at:O}=w;return{Status:ye(t),notes:N,"Created At":M(O).format("DD MMM YY hh:mm A")}})).sort((w,t)=>t.id-w.id)},{isLoading:k,data:c}=$({queryKey:["appointment-canc-req",n],queryFn:m}),_=async g=>{let h={appointment_id:n,status:g};try{const w=await F(D.token,"appointment_cancellation",h);w.response===200?C(a,"success","Updated!"):C(a,"error",w.message)}catch(w){C(a,"error",JSON.stringify(w))}};return Y({mutationFn:async g=>{_(g)},onSuccess:()=>{i.invalidateQueries(["appointment-canc-req",n]),i.invalidateQueries("appointment",n),i.invalidateQueries("appointments"),i.invalidateQueries("main-appointments")}}).isLoading?e.jsx(Z,{}):e.jsxs(x,{children:[k||!c?e.jsxs(x,{children:[e.jsxs(u,{mb:5,justify:"space-between",children:[e.jsx(l,{w:400,h:8}),e.jsx(l,{w:200,h:8})]}),e.jsx(l,{h:10,w:"100%",mt:2}),e.jsx(l,{h:10,w:"100%",mt:2}),e.jsx(l,{h:10,w:"100%",mt:2}),e.jsx(l,{h:10,w:"100%",mt:2}),e.jsx(l,{h:10,w:"100%",mt:2}),e.jsx(l,{h:10,w:"100%",mt:2}),e.jsx(l,{h:10,w:"100%",mt:2}),e.jsx(l,{h:10,w:"100%",mt:2}),e.jsx(l,{h:10,w:"100%",mt:2}),e.jsx(l,{h:10,w:"100%",mt:2})]}):e.jsxs(x,{children:[c.length?e.jsx(u,{mb:5,justify:"space-between",align:"center",children:e.jsxs(z,{size:"sm",children:[e.jsx(P,{fontSize:"sm",mb:0,color:y("gray.600","gray.300"),children:"Update Request Status"}),e.jsxs(ce,{children:[e.jsx(le,{as:v,rightIcon:e.jsx(oe,{}),bg:"transparent",w:"300px",textAlign:"left",pl:0,pt:0,h:8,_hover:{bg:"transparent"},_focus:{bg:"transparent"},borderBottom:"1px solid",borderBottomRadius:0,borderColor:y("gray.200","gray.600"),children:ye(s)}),(I=ke(s))!=null&&I.length?e.jsx(be,{children:(o=ke(s))==null?void 0:o.map(g=>e.jsx(ve,{onClick:()=>{d(),f(g)},children:e.jsx(x,{display:"flex",alignItems:"center",children:ye(g)})},g))}):null]})]})}):null,e.jsx(je,{minPad:"8px 10px",data:c})]}),e.jsx(Rt,{isOpen:r,onClose:p,id:n,type:j})]})},Mt=({isOpen:s,onClose:n,id:a,appData:i})=>{const r=X(),d=B(),p=Y({mutationFn:async j=>{i.source==="Admin"?await Ye({id:a,status:"Rejected"}):await Dt(j)},onSuccess:()=>{C(d,"success","Success"),r.invalidateQueries("appointments"),r.invalidateQueries("main-appointments"),r.invalidateQueries(["appointment",a]),n()},onError:j=>{C(d,"error",j.message)}});return p.isPending?e.jsx(Z,{}):e.jsx(Ee,{isOpen:s,onClose:n,isCentered:!0,children:e.jsx(he,{children:e.jsxs($e,{children:[e.jsxs(ue,{fontSize:"lg",fontWeight:"bold",children:["Reject Appointment , id : ",a]}),e.jsxs(xe,{children:["Are you sure? You ","can't"," undo this action afterwards."]}),e.jsxs(pe,{children:[e.jsx(v,{onClick:n,size:"sm",children:"Cancel"}),e.jsx(v,{colorScheme:"red",onClick:()=>{let j={appointment_id:a};p.mutate(j)},ml:3,size:"sm",children:"Reject"})]})]})})})},Rt=({isOpen:s,onClose:n,id:a,type:i})=>{const r=X(),d=B(),p=async m=>{let k={appointment_id:a,status:m};try{const c=await F(D.token,"appointment_cancellation",k);c.response===200?C(d,"success","Updated!"):C(d,"error",c.message)}catch(c){C(d,"error",JSON.stringify(c))}},j=Y({mutationFn:async m=>{await kt(m)},onSuccess:()=>{r.invalidateQueries("appointments"),r.invalidateQueries("main-appointments"),r.invalidateQueries(["appointment-canc-req",a]),r.invalidateQueries("appointment",a),n()},onError:m=>{C(d,"error",m.message),n()}}),f=Y({mutationFn:async m=>{await p(m)},onSuccess:()=>{r.invalidateQueries("appointments"),r.invalidateQueries("main-appointments"),r.invalidateQueries(["appointment-canc-req",a]),r.invalidateQueries("appointment",a),n()},onError:m=>{C(d,"error",m.message),n()}});return j.isPending||f.isPending?e.jsx(Z,{}):e.jsx(Ee,{isOpen:s,onClose:n,isCentered:!0,children:e.jsx(he,{children:e.jsxs($e,{children:[e.jsxs(ue,{fontSize:"md",fontWeight:"bold",children:[i," Request , id : ",a]}),e.jsxs(xe,{children:["Are you sure? update cancellation status to ",i]}),e.jsxs(pe,{children:[e.jsx(v,{onClick:n,size:"sm",children:"Cancel"}),e.jsxs(v,{colorScheme:"red",onClick:()=>{if(i==="Approved"){let m={appointment_id:a,status:"Approved"};j.mutate(m)}else f.mutate(i)},ml:3,size:"sm",children:[i," Cancellation Request"]})]})]})})})};export{os as default};
