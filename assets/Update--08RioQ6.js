import{Q as de,r as k,t as ce,j as e,R as we,B as c,v as D,F as _e,J as Z,w as A,E as ne,T as ie,C as _,G as ve,L as ze,ax as Te,U as Re,H as N,M as Ae,P as K}from"./index-DLnjnVCu.js";import{g as ee,u as he,L as ke,i as Fe,F as h,f as g}from"./index.esm-CU9MGMRa.js";import{u as se}from"./SettingData-5sbMzAiY.js";import{I as Ie,a as Ee}from"./IsdModal-DvHKxEmI.js";import{i as Ne}from"./image-BEsbZakN.js";import{P as oe}from"./PatientFiles-DHYo4lin.js";import{t as Be}from"./today-D_vLUvRX.js";import{T as Le,F as $e}from"./index-DscDBtoO.js";import{e as qe}from"./index-DizZbtXV.js";import{N as te,S as l,C as De,b as C,R as Ve,D as Oe,g as Ue,k as Me,l as We,c as Qe,d as Ge,e as U,f as He,h as M,T as le}from"./Dashboard-BVf00d6b.js";import{g as Ye}from"./CancellationReqBadge-ClDtE-KR.js";import{A as Je}from"./AddNewAppointment-XJHFswZL.js";import{u as W,B as Ke,k as Xe}from"./HasPermission-Efb43n4z.js";import{u as me}from"./UseSearchFilter-CSdYpLEl.js";import{F as n,I as x,b as m}from"./utils-DHjTyQ2S.js";import{I as V,A as Ze}from"./index-CrveBHTj.js";import{B}from"./chunk-Z6RXEUPO-CjATnNZs.js";import{T as es,a as ss,b as X,c as w,d as ts,e as S}from"./chunk-MGVPL3OH-BhiF1P3g.js";import{D as L}from"./index-Q7d3q0Zt.js";import{C as $,a as q}from"./chunk-YQO7BFFX-DeFCmj0r.js";import{S as as}from"./chunk-3RSXBRAN-DjkGz0-1.js";import{I as rs}from"./chunk-FKYN3ZGE-BIoTHd0a.js";import{V as ns}from"./chunk-NTCQBYKE-B0koUvDf.js";import"./DeletePatientFile-ALgrFW-j.js";import"./chunk-46CXQZ4E-BT9pxOQy.js";import"./UsePatientsData-Dd382CWd.js";import"./UsersComboBox-DGcvoZQW.js";import"./popover-Bdb83bZr.js";import"./useMutation-CH8xzEHB.js";import"./swiper-react-DUABaiBA.js";import"./chunk-JARCRF6W-CtmXHheL.js";import"./AddPatients-Cyv477UK.js";import"./chunk-Z3VR2BFQ-Dh96I6nM.js";function is({patientID:a}){const f=de(),{isOpen:j,onOpen:i,onClose:o}=ee(),P=he(),u="Errortoast",d=k.useRef(null),[b,v]=k.useState([]),{hasPermission:z}=W(),F=ce(),I=y=>{v(y)},T=async()=>{const y=`get_appointment/patient/${a}`,r=await Z(A.token,y);return r==null?void 0:r.data.map(R=>{const{id:xe,patient_id:je,status:ae,date:ue,time_slots:pe,type:J,payment_status:O,current_cancel_req_status:re,patient_f_name:ge,patient_l_name:fe,patient_phone:be,doct_f_name:ye,doct_l_name:Se,doct_image:Pe,source:Ce}=R;return{id:xe,image:Pe,Doctor:`${ye} ${Se}`,Patient:`${ge} ${fe} - #${je}`,phone:be,Status:Ue(ae),Date:ne(ue).format("DD MMM YYYY"),"Time Slots":ne(pe,"HH:mm:ss").format("hh:mm A"),Type:J==="Emergency"?e.jsx(B,{colorScheme:"red",children:J}):e.jsx(B,{colorScheme:"green",children:J}),"Payment Status":O==="Paid"?e.jsx(B,{colorScheme:"green",children:O}):O==="Refunded"?e.jsx(B,{colorScheme:"blue",children:O}):e.jsx(B,{colorScheme:"red",children:"Not Paid"}),"Cancellation Status":Ye(re),source:Ce,filterStatus:ae,current_cancel_req_status:re}})},{isLoading:E,data:t,error:s,isFetching:Q,isRefetching:G}=se({queryKey:["appointments","patient",a,b],queryFn:T}),{handleSearchChange:H,filteredData:Y}=me(t);return s?(P.isActive(u)||P({id:u,title:"Oops!",description:"Something bad happened.",status:"error",duration:2e3,isClosable:!0,position:"top"}),e.jsx(we,{errorCode:s.name})):z("APPOINTMENT_VIEW")?e.jsxs(c,{ref:d,children:[E||!t?e.jsxs(c,{children:[e.jsxs(n,{mb:5,justify:"space-between",children:[e.jsx(l,{w:400,h:8}),e.jsx(l,{w:200,h:8})]}),[...Array(10)].map((y,r)=>e.jsx(l,{h:10,w:"100%",mt:2},r))]}):e.jsxs(c,{children:[e.jsxs(n,{mb:5,justify:"space-between",align:"center",children:[e.jsx(x,{size:"md",placeholder:"Search",w:400,maxW:"50vw",onChange:y=>H(y.target.value)}),e.jsx(c,{children:e.jsx(D,{size:"sm",colorScheme:"blue",onClick:()=>{i()},children:"Add New"})})]}),e.jsxs(n,{alignItems:"top",justifyContent:"space-between",children:[" ",e.jsx(De,{colorScheme:"blue",onChange:I,value:b,children:e.jsxs(n,{mb:5,gap:4,alignItems:"center",children:[e.jsx(C,{value:"Confirmed",children:"Confirmed"}),e.jsx(C,{value:"Visited",children:"Visited"}),e.jsx(C,{value:"Completed",children:"Completed"}),e.jsx(C,{value:"Pending",children:"Pending"}),e.jsx(C,{value:"Cancelled",children:"Cancelled"}),e.jsx(C,{value:"Rejected",children:"Rejected"}),e.jsx(C,{value:"Cancellation",children:"Cancellation Initiated"})]})})," ",e.jsx(D,{isLoading:Q||G,size:"sm",colorScheme:"blue",onClick:()=>{F.invalidateQueries(["appointments","patient",a,b],{refetchInactive:!0})},rightIcon:e.jsx(Ve,{size:14}),children:"Refresh Table"})]}),e.jsx(Oe,{minPad:"1px 10px",data:Y,onActionClick:e.jsx(os,{onClick:()=>{},navigate:f})})]}),j&&e.jsx(Je,{isOpen:j,onClose:o,PatientID:a})]}):e.jsx(te,{})}const os=({onClick:a,rowData:f,navigate:j})=>{const{hasPermission:i}=W();return e.jsx(n,{justify:"center",children:i("APPOINTMENT_UPDATE")&&e.jsx(V,{size:"sm",variant:"ghost",_hover:{background:"none"},onClick:()=>{a(f),j(`/appointment/${f.id}`)},icon:e.jsx(qe,{fontSize:18,color:_e.colors.blue[500]})})})};function ls({patientID:a,queryActive:f}){const{hasPermission:j}=W(),[i,o]=k.useState(),{isOpen:P,onOpen:u,onClose:d}=ee(),b=async()=>(await Z(A.token,`get_prescription/patient/${a}`)).data,{isLoading:v,data:z,error:F}=se({queryKey:["prescriptions-patient",a],queryFn:b,enabled:f}),{handleSearchChange:I,filteredData:T}=me(z);if(F)return e.jsx(ie,{color:"red.500",children:"Error loading data"});const E=t=>{const s=window.open(t,"_blank");s&&(s.focus(),s.onload=()=>{s.load(),s.onafterprint=()=>{s.close()}})};return j("PRESCRIPTION_VIEW")?e.jsxs(c,{children:[v?e.jsxs(c,{children:[e.jsxs(n,{mb:5,justify:"space-between",children:[e.jsx(l,{w:400,h:8}),e.jsx(l,{w:200,h:8})]}),e.jsx(l,{h:10,w:"100%",mt:2}),e.jsx(l,{h:10,w:"100%",mt:2}),e.jsx(l,{h:10,w:"100%",mt:2}),e.jsx(l,{h:10,w:"100%",mt:2}),e.jsx(l,{h:10,w:"100%",mt:2}),e.jsx(l,{h:10,w:"100%",mt:2}),e.jsx(l,{h:10,w:"100%",mt:2}),e.jsx(l,{h:10,w:"100%",mt:2}),e.jsx(l,{h:10,w:"100%",mt:2}),e.jsx(l,{h:10,w:"100%",mt:2})]}):e.jsxs(c,{children:[e.jsx(n,{mb:4,alignItems:"center",justify:"space-between",children:e.jsx(x,{placeholder:"Search",w:400,maxW:"50vw",mr:2,icon:e.jsx(Me,{}),onChange:t=>I(t.target.value),size:"md"})}),e.jsx(c,{borderWidth:"1px",borderRadius:"lg",overflow:"scroll",maxW:"100%",children:e.jsxs(es,{variant:"simple",colorScheme:"gray",fontSize:12,size:"sm",fontWeight:500,children:[e.jsx(ss,{background:_("blue.50","blue.700"),children:e.jsxs(X,{children:[e.jsx(w,{padding:2,children:"ID"}),e.jsx(w,{padding:2,children:"Appointment ID"}),e.jsx(w,{padding:2,children:"Patient"}),e.jsx(w,{padding:2,children:"Date"}),e.jsx(w,{padding:2,children:"Pulse Rate"}),e.jsx(w,{padding:2,children:"Temperature"}),e.jsx(w,{padding:2,textAlign:"center",children:"Action"})]})}),e.jsx(ts,{children:z.length>0?T.map(t=>e.jsxs(X,{children:[e.jsx(S,{padding:2,children:t.id})," ",e.jsx(S,{padding:2,children:t.appointment_id}),e.jsx(S,{padding:2,children:`${t.patient_f_name} ${t.patient_l_name}`}),e.jsx(S,{padding:2,children:t.date}),e.jsx(S,{padding:2,children:t.pulse_rate}),e.jsx(S,{padding:2,children:t.temperature}),e.jsx(S,{padding:2,maxW:10,children:e.jsxs(n,{alignItems:"center",justifyContent:"center",children:[" ",e.jsx(V,{as:ke,"aria-label":"Filter",icon:e.jsx(Ke,{fontSize:22}),colorScheme:"whatsapp",size:"sm",variant:"ghost",target:"_blank",rel:"noopener noreferrer",onClick:()=>{E(`${ve}/prescription/generatePDF/${t.id}`)}}),j("PRESCRIPTION_UPDATE")&&e.jsx(V,{as:ze,"aria-label":"Filter",icon:e.jsx(Ze,{fontSize:24}),colorScheme:"blue",size:"sm",variant:"ghost",to:`/prescription/${t==null?void 0:t.id}/?appointmentID=${t==null?void 0:t.appointment_id}&patientID=${t==null?void 0:t.patient_id}`}),e.jsx(V,{"aria-label":"Filter",icon:e.jsx(Xe,{fontSize:20}),colorScheme:"red",size:"sm",variant:"ghost",onClick:()=>{u(),o(t)}})," "]})})]},t.id)):e.jsx(X,{children:e.jsx(S,{colSpan:"7",children:e.jsx(ie,{align:"center",children:"No data available in table"})})})})]})})]}),P&&e.jsx(We,{isOpen:P,onClose:d,data:i})]}):e.jsx(te,{})}function Os(){const{id:a}=Te(),f=de(),[j,i]=k.useState(),{register:o,handleSubmit:P}=Fe(),u=ce(),d=he(),[b,v]=k.useState(),{isOpen:z,onOpen:F,onClose:I}=ee(),T=k.useRef(),{hasPermission:E}=W(),t=async()=>{const r=await Z(A.token,`get_patients/${a}`);return v(r.data.isd_code),r.data},{data:s,isLoading:Q}=se({queryKey:["patient",a],queryFn:t}),G=async r=>{let p={id:a,isd_code:b,...r};try{i(!0);const R=await K(A.token,"update_patient",p);i(!1),R.response===200?(g(d,"success","Patient Updated!"),u.invalidateQueries(["patient",a]),u.invalidateQueries(["patients"])):g(d,"error",R.message)}catch(R){i(!1),g(d,"error",JSON.stringify(R))}},H=async r=>{try{i(!0);const p=await K(A.token,"update_patient",{id:a,image:r});i(!1),p.response===200?(g(d,"success","Patient Updated!"),u.invalidateQueries(["patient",a]),u.invalidateQueries(["patients"])):g(d,"error",p.message)}catch(p){i(!1),g(d,"error",JSON.stringify(p))}},Y=r=>{const p=r.target.files[0];H(p)},y=async()=>{try{i(!0);const r=await K(A.token,"remove_patient_image",{id:a});i(!1),r.response===200?(g(d,"success","Image Deleted!"),u.invalidateQueries("patient",a)):g(d,"error",r.message)}catch(r){i(!1),g(d,"error",JSON.stringify(r))}};return Q||j?e.jsx(Re,{}):E("PATIENT_UPDATE")?e.jsxs(c,{children:[e.jsxs(n,{justify:"space-between",alignItems:"center",children:[e.jsx(N,{as:"h1",size:"lg",children:"Patients Details"}),e.jsx(D,{w:120,size:"sm",variant:_("blackButton","gray"),onClick:()=>{f(-1)},children:"Back"})]}),e.jsx(L,{mb:2,mt:3}),e.jsxs(Qe,{children:[e.jsxs(Ge,{children:[e.jsx(U,{children:"Details"}),e.jsx(U,{children:"Patient Files"}),e.jsx(U,{children:"Patient Appointments"}),e.jsx(U,{children:"Patient Prescriptions"})]}),e.jsxs(He,{children:[e.jsx(M,{children:e.jsxs(n,{gap:10,mt:2,as:"form",onSubmit:P(G),children:[e.jsxs(c,{w:"60%",children:[" ",e.jsx($,{mt:5,bg:_("white","gray.700"),children:e.jsxs(q,{p:3,as:"form",children:[e.jsxs(n,{align:"center",justify:"space-between",children:[" ",e.jsxs(N,{as:"h3",size:"sm",children:["Basic Details -"," "]})," "]}),e.jsx(L,{mt:2,mb:5}),e.jsxs(n,{gap:10,mt:5,align:"flex-end",children:[e.jsxs(m,{isRequired:!0,children:[e.jsx(h,{children:"First Name"}),e.jsx(x,{size:"sm",borderRadius:6,placeholder:"First Name",...o("f_name",{required:!0}),defaultValue:s==null?void 0:s.f_name})]}),e.jsxs(m,{isRequired:!0,children:[e.jsx(h,{children:"Last Name"}),e.jsx(x,{size:"sm",borderRadius:6,placeholder:"Last Name",...o("l_name",{required:!0}),defaultValue:s==null?void 0:s.l_name})]})]}),e.jsxs(n,{gap:10,mt:5,children:[e.jsxs(m,{isRequired:!0,children:[e.jsx(h,{children:"Date Of Birth"}),e.jsx(x,{max:Be(),size:"sm",borderRadius:6,placeholder:"Select Date",type:"date",...o("dob",{required:!0}),defaultValue:s==null?void 0:s.dob})]}),e.jsxs(m,{children:[e.jsx(h,{children:"Gender"}),e.jsxs(as,{size:"sm",borderRadius:6,placeholder:"Select Gender",...o("gender"),defaultValue:s==null?void 0:s.gender,children:[e.jsx("option",{value:"Female",children:"Female"})," ",e.jsx("option",{value:"Male",children:"Male"})]})]})]}),e.jsx(n,{gap:10,mt:5,children:e.jsxs(m,{children:[e.jsx(h,{children:"Notes"}),e.jsx(le,{placeholder:"Notes",size:"sm",resize:"vertical",...o("notes"),defaultValue:s==null?void 0:s.notes})]})})]})}),e.jsx($,{mt:5,bg:_("white","gray.700"),children:e.jsxs(q,{p:3,as:"form",children:[e.jsxs(n,{align:"center",justify:"space-between",children:[" ",e.jsx(N,{as:"h3",size:"sm",children:"Contact Details -"})," "]}),e.jsx(L,{mt:2,mb:5}),e.jsxs(n,{gap:10,mt:5,children:[e.jsxs(m,{children:[e.jsx(h,{children:"Email"}),e.jsx(x,{size:"sm",borderRadius:6,type:"email",placeholder:"Email",...o("email"),defaultValue:s==null?void 0:s.email})]}),e.jsxs(m,{mt:0,isRequired:!0,children:[e.jsx(h,{children:"Phone "}),e.jsxs(rs,{size:"sm",children:[e.jsx(Ie,{cursor:"pointer",onClick:r=>{r.stopPropagation(),F()},children:b}),e.jsx(x,{borderRadius:6,placeholder:"Enter your phone number",type:"Tel",fontSize:16,...o("phone",{required:!0}),defaultValue:s==null?void 0:s.phone})]})]})]})]})}),e.jsx($,{mt:5,bg:_("white","gray.700"),children:e.jsxs(q,{p:3,as:"form",children:[e.jsxs(n,{align:"center",justify:"space-between",children:[" ",e.jsxs(N,{as:"h3",size:"sm",children:["Address -"," "]})," "]}),e.jsx(L,{mt:2,mb:5}),e.jsxs(n,{gap:10,children:[e.jsxs(m,{children:[e.jsx(h,{children:"State"}),e.jsx(x,{size:"sm",borderRadius:6,type:"email",placeholder:"State",...o("state"),defaultValue:s==null?void 0:s.state})]}),e.jsxs(m,{children:[e.jsx(h,{children:"City"}),e.jsx(x,{size:"sm",borderRadius:6,type:"text",placeholder:"City",...o("city"),defaultValue:s.city})]}),e.jsxs(m,{children:[e.jsx(h,{children:"Postal Code"}),e.jsx(x,{size:"sm",borderRadius:6,type:"number",placeholder:"Postal Code",...o("postal_code"),defaultValue:s.postal_code})]})]}),e.jsx(n,{gap:10,mt:5,children:e.jsxs(m,{children:[e.jsx(h,{children:"Address"}),e.jsx(le,{placeholder:"Address",size:"sm",resize:"vertical",...o("address"),defaultValue:s==null?void 0:s.address})]})})]})}),e.jsx(D,{w:"100%",mt:10,type:"submit",colorScheme:"green",size:"sm",isLoading:j,children:"Update"})]}),e.jsxs(c,{w:"35%",children:[e.jsx($,{mt:5,bg:_("white","gray.700"),h:"fit-content",pb:5,children:e.jsxs(q,{p:2,children:[e.jsx(N,{as:"h3",size:"sm",textAlign:"center",children:"Profile Picture"}),e.jsx(L,{mt:2}),e.jsxs(n,{p:2,justify:"center",mt:5,position:"relative",children:[e.jsx(Ae,{borderRadius:"50%",h:150,objectFit:"cover",w:150,src:s!=null&&s.image?`${Ne}/${s==null?void 0:s.image}`:"/admin/profilePicturePlaceholder.png"}),(s==null?void 0:s.image)&&e.jsx(Le,{label:"Delete",fontSize:"md",children:e.jsx(V,{size:"sm",colorScheme:"red",variant:"solid",position:"absolute",right:5,icon:e.jsx($e,{}),onClick:()=>{y()}})})]}),e.jsxs(ns,{spacing:4,align:"stretch",mt:10,children:[e.jsx(x,{size:"sm",borderRadius:6,type:"file",display:"none",ref:T,onChange:Y,accept:".jpeg, .svg, .png , .jpg"}),e.jsx(D,{size:"sm",onClick:()=>{T.current.click()},colorScheme:"blue",children:"Upload Profile Picture"})]})]})}),e.jsx($,{mt:5,bg:_("white","gray.700"),h:"fit-content",pb:5,children:e.jsx(q,{p:2,children:e.jsx(oe,{id:a})})})]})]})}),e.jsx(M,{children:e.jsxs(c,{maxW:500,children:[" ",e.jsx(oe,{id:a})]})}),e.jsx(M,{children:e.jsx(is,{patientID:a})}),e.jsx(M,{children:e.jsx(ls,{patientID:a,queryActive:!0})})]})]}),e.jsx(Ee,{isOpen:z,onClose:I,setisd_code:v})]}):e.jsx(te,{})}export{Os as default};
