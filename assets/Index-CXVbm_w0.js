import{r as D,t as N,j as e,B as j,T as F,N as W,O as Y,v as S,P as ie,w as A,D as $,M as ne,av as G,F as V,J as oe}from"./index-DLnjnVCu.js";import{F as ae}from"./index-DscDBtoO.js";import{e as le}from"./index-DizZbtXV.js";import{u as ce}from"./SettingData-5sbMzAiY.js";import{u as de}from"./useMutation-CH8xzEHB.js";import{T as K,V as X,A as ue,a as me,N as pe,S as P,D as he}from"./Dashboard-BVf00d6b.js";import{a as Z,I as H}from"./index-CrveBHTj.js";import{i as ee,u as O,M as se,b as I,a as te,c as B,h as re,d as U,F as R,e as Q,f as c,g as _}from"./index.esm-CU9MGMRa.js";import{D as w}from"./index-Q7d3q0Zt.js";import{b as k,I as z,F as M}from"./utils-DHjTyQ2S.js";import{i as xe}from"./image-BEsbZakN.js";import{u as je}from"./UseSearchFilter-CSdYpLEl.js";import{u as J}from"./HasPermission-Efb43n4z.js";import{S as fe}from"./chunk-VTV6N5LE-DNMtDClH.js";import"./chunk-MGVPL3OH-BhiF1P3g.js";import"./chunk-Z6RXEUPO-CjATnNZs.js";function ge({isOpen:u,onClose:r}){const[s,i]=D.useState(),[n,m]=D.useState(null),d=D.useRef(),{register:t,handleSubmit:a,reset:p}=ee(),o=N(),C=O(),b=h=>{h.preventDefault();const g=h.dataTransfer.files[0];m(g)},v=h=>{h.preventDefault()},f=h=>{const g=h.target.files[0];m(g)},T=async h=>{let g={...h,image:n};try{i(!0);const y=await ie(A.token,"add_department",g);i(!1),y.response===200?(c(C,"success","Department Added!"),o.invalidateQueries("department"),p(),r()):c(C,"error",y.message)}catch(y){i(!1),c(C,"error",JSON.stringify(y))}};return e.jsxs(se,{isOpen:u,onClose:r,isCentered:!0,size:"lg",children:[e.jsx(I,{}),e.jsxs(te,{as:"form",onSubmit:a(T),children:[e.jsx(B,{fontSize:18,py:2,children:"Add Department"}),e.jsx(re,{}),e.jsx(w,{}),e.jsx(U,{children:e.jsxs(j,{pb:3,children:[e.jsxs(k,{isRequired:!0,children:[e.jsx(R,{children:"Title"}),e.jsx(z,{placeholder:"Title",...t("title",{required:!0})})]}),e.jsxs(k,{isRequired:!0,mt:5,children:[e.jsx(R,{children:"Description"}),e.jsx(K,{placeholder:"Description",...t("description",{required:!0})})]}),e.jsx(j,{mt:5,p:4,border:"2px dashed",borderColor:"gray.300",borderRadius:"md",onDrop:b,onDragOver:v,onClick:()=>{d.current&&d.current.click()},cursor:"pointer",children:n?e.jsxs(j,{position:"relative",children:[e.jsxs(F,{children:["Selected File: ",n.name]}),e.jsx(W,{position:"absolute",right:-2,top:-2,size:"sm",onClick:()=>{m(null)}})]}):e.jsxs(j,{children:[e.jsxs(X,{children:[" ",e.jsx(z,{ref:d,type:"file",onChange:f,accept:".jpeg, .svg, .png , .jpg",mb:4})]}),e.jsxs(Y,{children:[" ",e.jsx(Z,{fontSize:32})]}),e.jsxs(F,{textAlign:"center",mt:3,children:[e.jsx("b",{children:"Choose a file"})," or Drag it here."]})]})})]})}),e.jsx(w,{}),e.jsxs(Q,{py:3,children:[e.jsx(S,{colorScheme:"gray",mr:3,onClick:r,size:"sm",children:"Close"}),e.jsx(S,{variant:"solid",size:"sm",colorScheme:"blue",type:"submit",isLoading:s,children:"Add Department"})]})]})]})}function De({isOpen:u,onClose:r,data:s}){const i=O(),n=D.useRef(),m=N(),[d,t]=D.useState(),a=async()=>{let p={id:s.id};try{t(!0);const o=await $(A.token,"delete_department",p);t(!1),o.response===200?(c(i,"success","Department Deleted!"),m.invalidateQueries("department"),r()):c(i,"error",o.message)}catch(o){t(!1),c(i,"error",JSON.stringify(o))}};return e.jsx(ue,{isOpen:u,onClose:r,leastDestructiveRef:n,isCentered:!0,children:e.jsx(I,{children:e.jsxs(me,{children:[e.jsxs(B,{fontSize:"lg",fontWeight:"semi-bold",children:["Delete Department ( ",e.jsx("b",{children:s==null?void 0:s.title})," )"]}),e.jsx(U,{children:"Are you sure? You can not undo this action afterwards."}),e.jsxs(Q,{children:[e.jsx(S,{ref:n,onClick:r,colorScheme:"gray",size:"sm",children:"Cancel"}),e.jsx(S,{colorScheme:"red",onClick:a,ml:3,size:"sm",isLoading:d,children:"Delete"})]})]})})})}function ye({isOpen:u,onClose:r,data:s}){const[i,n]=D.useState(),[m,d]=D.useState(),[t,a]=D.useState(null),p=D.useRef(),{register:o,handleSubmit:C,reset:b}=ee(),v=N(),f=O(),T=x=>{x.preventDefault();const l=x.dataTransfer.files[0];a(l)},h=x=>{x.preventDefault()},g=x=>{const l=x.target.files[0];a(l)},y=async x=>{let l={...x,image:t,id:s.id};try{n(!0);const E=await G(A.token,"udpate_department",l);n(!1),E.response===200?(c(f,"success","Department Updated!"),v.invalidateQueries(["department"]),b(),a(null),r()):c(f,"error",E.message)}catch(E){n(!1),c(f,"error",JSON.stringify(E))}},q=async()=>{let x={id:s.id};try{d(!0);const l=await $(A.token,"remove_department_image",x);d(!1),l.response===200?(c(f,"success","Image deleted!"),v.invalidateQueries(["department"]),b(),a(null),r()):c(f,"error",l.message)}catch(l){d(!1),c(f,"error",JSON.stringify(l))}};return e.jsxs(se,{isOpen:u,onClose:r,isCentered:!0,size:"lg",scrollBehavior:"inside",children:[e.jsx(I,{}),e.jsxs(te,{as:"form",onSubmit:C(y),children:[e.jsx(B,{fontSize:18,py:2,children:"Update Department"}),e.jsx(re,{}),e.jsx(w,{}),e.jsx(U,{children:e.jsxs(j,{pb:3,children:[e.jsxs(k,{isRequired:!0,children:[e.jsx(R,{children:"Title"}),e.jsx(z,{defaultValue:s==null?void 0:s.title,placeholder:"Title",...o("title",{required:!0})})]}),e.jsxs(k,{isRequired:!0,mt:5,children:[e.jsx(R,{children:"Description"}),e.jsx(K,{defaultValue:s==null?void 0:s.description,placeholder:"Description",...o("description",{required:!0})})]}),(s==null?void 0:s.image)&&e.jsxs(M,{mt:5,align:"center",gap:5,children:[e.jsx(ne,{src:`${xe}/${s==null?void 0:s.image}`,width:100,borderRadius:5}),e.jsx(S,{size:"sm",colorScheme:"red",fontSize:12,isLoading:m,onClick:q,children:"Remove Image"})]}),!(s!=null&&s.image)&&e.jsx(j,{mt:5,p:4,border:"2px dashed",borderColor:"gray.300",borderRadius:"md",onDrop:T,onDragOver:h,onClick:()=>{p.current&&p.current.click()},cursor:"pointer",children:t?e.jsxs(j,{position:"relative",children:[e.jsxs(F,{children:["Selected File: ",t.name]}),e.jsx(W,{position:"absolute",right:-2,top:-2,size:"sm",onClick:()=>{a(null)}})]}):e.jsxs(j,{children:[e.jsxs(X,{children:[" ",e.jsx(z,{ref:p,type:"file",onChange:g,accept:".jpeg, .svg, .png , .jpg",mb:4})]}),e.jsxs(Y,{children:[" ",e.jsx(Z,{fontSize:32})]}),e.jsxs(F,{textAlign:"center",mt:3,children:[e.jsx("b",{children:"Choose a file"})," or Drag it here."]})]})})]})}),e.jsx(w,{}),e.jsxs(Q,{py:3,children:[e.jsx(S,{colorScheme:"gray",mr:3,onClick:r,size:"sm",children:"Close"}),e.jsx(S,{variant:"solid",size:"sm",colorScheme:"blue",type:"submit",isLoading:i,children:"Update Department"})]})]})]})}function _e(){const{isOpen:u,onOpen:r,onClose:s}=_(),[i,n]=D.useState(),{hasPermission:m}=J(),{isOpen:d,onOpen:t,onClose:a}=_(),{isOpen:p,onOpen:o,onClose:C}=_(),b=O(),v="Errortoast",f=async()=>(await oe(A.token,"get_department")).data.map(L=>({...L,active:e.jsx(Ce,{id:L.id,isActive:L.active})})),T=l=>{n(l)},{isLoading:h,data:g,error:y}=ce({queryKey:["department"],queryFn:f}),{handleSearchChange:q,filteredData:x}=je(g);return y&&(b.isActive(v)||b({id:v,title:"oops!.",description:"Something bad happens.",status:"error",duration:2e3,isClosable:!0,position:"top"})),m("DEPARTMENT_VIEW")?e.jsxs(j,{children:[h||!g?e.jsxs(j,{children:[e.jsxs(M,{mb:5,justify:"space-between",children:[e.jsx(P,{w:400,h:8}),e.jsx(P,{w:50,h:8})]}),e.jsx(P,{h:300,w:"100%"})]}):e.jsxs(j,{children:[e.jsxs(M,{mb:5,justify:"space-between",align:"center",children:[e.jsx(z,{size:"md",placeholder:"Search",w:400,maxW:"50vw",onChange:l=>q(l.target.value)}),m("DEPARTMENT_ADD")&&e.jsx(j,{children:e.jsx(S,{size:"sm",colorScheme:"blue",onClick:r,children:"Add New"})})]}),e.jsx(he,{minPad:"8px 8px",data:x,onActionClick:e.jsx(Se,{onClick:T,DeleteonOpen:t,EditonOpen:o})})]}),e.jsx(ge,{isOpen:u,onClose:s}),e.jsx(De,{isOpen:d,onClose:a,data:i}),p&&e.jsx(ye,{isOpen:p,onClose:C,data:i})]}):e.jsx(pe,{})}const Se=({onClick:u,rowData:r,DeleteonOpen:s,EditonOpen:i})=>{const{hasPermission:n}=J();return e.jsxs(M,{justify:"center",children:[n("DEPARTMENT_UPDATE")&&e.jsx(H,{size:"sm",variant:"ghost",_hover:{background:"none"},onClick:()=>{u(r),i()},icon:e.jsx(le,{fontSize:18,color:V.colors.blue[500]})}),n("DEPARTMENT_DELETE")&&e.jsx(H,{size:"sm",variant:"ghost",_hover:{background:"none"},onClick:()=>{u(r),s()},icon:e.jsx(ae,{fontSize:18,color:V.colors.red[500]})})]})},Ce=({id:u,isActive:r})=>{const{hasPermission:s}=J(),i=O(),n=N(),m=async(t,a)=>{let p={id:t,active:a};try{const o=await G(A.token,"udpate_department",p);o.response===200?(c(i,"success","Updated!"),n.invalidateQueries(["department"]),n.invalidateQueries(["department",t])):c(i,"error",o.message)}catch(o){c(i,"error",JSON.stringify(o))}},d=de({mutationFn:async t=>{await m(t.id,t.active)}});return e.jsx(k,{display:"flex",alignItems:"center",children:e.jsx(fe,{isDisabled:!s("DEPARTMENT_UPDATE"),defaultChecked:r===1,size:"sm",onChange:t=>{let a=t.target.checked?1:0;d.mutate({id:u,active:a})}})})};export{Ce as IsActive,_e as default};
