import{r as S,t as q,j as e,B as f,v as D,av as ee,w as O,D as se,P as De,H as te,F as U,J as re}from"./index-DLnjnVCu.js";import{F as ne}from"./index-DscDBtoO.js";import{e as oe}from"./index-DizZbtXV.js";import{u as ie}from"./SettingData-5sbMzAiY.js";import{u as ye}from"./useMutation-CH8xzEHB.js";import{A as ae,a as ce,N as le,S as _,D as de,c as Se,d as be,e as X,f as Oe,h as Z}from"./Dashboard-BVf00d6b.js";import{i as ue,u as v,M as pe,b as T,a as he,c as N,h as xe,d as R,F as g,e as F,f as p,g as A}from"./index.esm-CU9MGMRa.js";import{D as E}from"./index-Q7d3q0Zt.js";import{b as m,I as j,F as b}from"./utils-DHjTyQ2S.js";import{u as je}from"./UseSearchFilter-CSdYpLEl.js";import{u as w}from"./HasPermission-Efb43n4z.js";import{I as P}from"./index-CrveBHTj.js";import{S as ve}from"./chunk-VTV6N5LE-DNMtDClH.js";import"./chunk-MGVPL3OH-BhiF1P3g.js";import"./image-BEsbZakN.js";import"./chunk-Z6RXEUPO-CjATnNZs.js";function me({isOpen:a,onClose:r,data:s}){const[n,t]=S.useState(),{register:c,handleSubmit:h,reset:o}=ue(),l=q(),d=v(),i=async y=>{let x={...y,title:y.title.toUpperCase(),id:s.id};try{t(!0);const C=await ee(O.token,"update_coupon",x);t(!1),C.response===200?(p(d,"success","Coupon Updated!"),l.invalidateQueries("coupons"),o(),r()):p(d,"error",C.message)}catch(C){t(!1),p(d,"error",JSON.stringify(C))}};return e.jsxs(pe,{isOpen:a,onClose:r,isCentered:!0,size:"lg",scrollBehavior:"inside",children:[e.jsx(T,{}),e.jsxs(he,{as:"form",onSubmit:h(i),children:[e.jsx(N,{fontSize:18,py:2,children:"Update Coupon"}),e.jsx(xe,{}),e.jsx(E,{}),e.jsx(R,{children:e.jsxs(f,{pb:3,children:[e.jsxs(m,{isRequired:!0,children:[e.jsx(g,{children:"Title"}),e.jsx(j,{defaultValue:s.title,textTransform:"uppercase",placeholder:"Title",...c("title",{required:!0})})]}),e.jsxs(m,{isRequired:!0,mt:5,children:[e.jsx(g,{children:"Value ( Off in %)"}),e.jsx(j,{defaultValue:s.value,type:"number",placeholder:"Value",max:100,...c("value",{required:!0})})]}),e.jsxs(m,{isRequired:!0,mt:5,children:[e.jsx(g,{children:"Description"}),e.jsx(j,{defaultValue:s.description,placeholder:"Description",...c("description",{required:!0})})]}),e.jsxs(b,{mt:5,gap:5,children:[" ",e.jsxs(m,{isRequired:!0,children:[e.jsx(g,{children:"Start Date"}),e.jsx(j,{defaultValue:s.start_date,type:"date",placeholder:"Start Date",...c("start_date",{required:!0})})]})," ",e.jsxs(m,{isRequired:!0,children:[e.jsx(g,{children:"End Date"}),e.jsx(j,{defaultValue:s.end_date,type:"date",placeholder:"End Date",...c("end_date",{required:!0})})]})]})]})}),e.jsx(E,{}),e.jsxs(F,{py:3,children:[e.jsx(D,{colorScheme:"gray",mr:3,onClick:r,size:"sm",children:"Close"}),e.jsx(D,{variant:"solid",size:"sm",colorScheme:"blue",type:"submit",isLoading:n,children:"Update Coupon"})]})]})]})}function _e({isOpen:a,onClose:r,data:s}){const n=v(),t=S.useRef(),c=q(),[h,o]=S.useState(),l=async()=>{let d={id:s.id};try{o(!0);const i=await se(O.token,"delete_coupon",d);o(!1),i.response===200?(p(n,"success","Coupon Deleted!"),c.invalidateQueries("coupons"),r()):p(n,"error",i.message)}catch(i){o(!1),p(n,"error",JSON.stringify(i))}};return e.jsx(ae,{isOpen:a,onClose:r,leastDestructiveRef:t,isCentered:!0,children:e.jsx(T,{children:e.jsxs(ce,{children:[e.jsxs(N,{fontSize:"lg",fontWeight:"semi-bold",children:["Delete Coupon ( ",e.jsx("b",{children:s==null?void 0:s.title})," )"]}),e.jsx(R,{children:"Are you sure? You can not undo this action afterwards."}),e.jsxs(F,{children:[e.jsx(D,{ref:t,onClick:r,colorScheme:"gray",size:"sm",children:"Cancel"}),e.jsx(D,{colorScheme:"red",onClick:l,ml:3,size:"sm",isLoading:h,children:"Delete"})]})]})})})}function fe({isOpen:a,onClose:r}){const[s,n]=S.useState(),{register:t,handleSubmit:c,reset:h}=ue(),o=q(),l=v(),d=async i=>{let y={...i,active:1,title:i.title.toUpperCase()};try{n(!0);const x=await De(O.token,"add_coupon",y);n(!1),x.response===200?(p(l,"success","Coupon Added!"),o.invalidateQueries(["coupons"]),h(),r()):p(l,"error",x.message)}catch(x){n(!1),p(l,"error",JSON.stringify(x))}};return e.jsxs(pe,{isOpen:a,onClose:r,isCentered:!0,size:"lg",children:[e.jsx(T,{}),e.jsxs(he,{as:"form",onSubmit:c(d),children:[e.jsx(N,{fontSize:18,py:2,children:"Add Coupon"}),e.jsx(xe,{}),e.jsx(E,{}),e.jsx(R,{children:e.jsxs(f,{pb:3,children:[e.jsxs(m,{isRequired:!0,children:[e.jsx(g,{children:"Title"}),e.jsx(j,{textTransform:"uppercase",placeholder:"Title",...t("title",{required:!0})})]}),e.jsxs(m,{isRequired:!0,mt:5,children:[e.jsx(g,{children:"Value ( Off in %)"}),e.jsx(j,{type:"number",placeholder:"Value",max:100,...t("value",{required:!0})})]}),e.jsxs(m,{isRequired:!0,mt:5,children:[e.jsx(g,{children:"Description"}),e.jsx(j,{placeholder:"Description",...t("description",{required:!0})})]}),e.jsxs(b,{mt:5,gap:5,children:[" ",e.jsxs(m,{isRequired:!0,children:[e.jsx(g,{children:"Start Date"}),e.jsx(j,{type:"date",placeholder:"Start Date",...t("start_date",{required:!0})})]})," ",e.jsxs(m,{isRequired:!0,children:[e.jsx(g,{children:"End Date"}),e.jsx(j,{type:"date",placeholder:"End Date",...t("end_date",{required:!0})})]})]})]})}),e.jsx(E,{}),e.jsxs(F,{py:3,children:[e.jsx(D,{colorScheme:"gray",mr:3,onClick:r,size:"sm",children:"Close"}),e.jsx(D,{variant:"solid",size:"sm",colorScheme:"blue",type:"submit",isLoading:s,children:"Add Coupon"})]})]})]})}function Ae(){const{isOpen:a,onOpen:r,onClose:s}=A(),[n,t]=S.useState(),{hasPermission:c}=w(),{isOpen:h,onOpen:o,onClose:l}=A(),{isOpen:d,onOpen:i,onClose:y}=A(),x=v(),C="Errortoast",L=async()=>{const u=await re(O.token,"get_coupon");return u==null?void 0:u.data.map(J=>{const{id:z,active:W,title:H,value:Y,description:$,updated_at:K,start_date:G,end_date:ge}=J;return{active:e.jsx(ke,{id:z,isActive:W}),id:z,title:H,value:Y,description:$,start_date:G,end_date:ge,updated_at:K}})},V=u=>{t(u)},{isLoading:M,data:k,error:B}=ie({queryKey:["coupons"],queryFn:L}),{handleSearchChange:Q,filteredData:I}=je(k);return B&&(x.isActive(C)||x({id:C,title:"oops!.",description:"Something bad happens.",status:"error",duration:2e3,isClosable:!0,position:"top"})),c("COUPON_VIEW")?e.jsxs(f,{children:[M||!k?e.jsxs(f,{children:[e.jsxs(b,{mb:5,justify:"space-between",children:[e.jsx(_,{w:400,h:8}),e.jsx(_,{w:50,h:8})]}),e.jsx(_,{h:300,w:"100%"})]}):e.jsxs(f,{children:[e.jsx(te,{as:"h1",size:"md",mb:2,children:"All Coupons"})," ",e.jsx(E,{mb:2}),e.jsxs(b,{mb:5,justify:"space-between",align:"center",children:[e.jsx(j,{size:"md",placeholder:"Search",w:400,maxW:"50vw",onChange:u=>Q(u.target.value)}),c("COUPON_ADD")&&e.jsx(f,{children:e.jsx(D,{size:"sm",colorScheme:"blue",onClick:r,children:"Add New"})})]}),e.jsx(de,{minPad:"8px 8px",data:I,onActionClick:e.jsx(Ee,{onClick:V,DeleteonOpen:o,EditonOpen:i})})]}),e.jsx(fe,{isOpen:a,onClose:s}),e.jsx(_e,{isOpen:h,onClose:l,data:n}),d&&e.jsx(me,{isOpen:d,onClose:y,data:n})]}):e.jsx(le,{})}const Ee=({onClick:a,rowData:r,DeleteonOpen:s,EditonOpen:n})=>{const{hasPermission:t}=w();return e.jsxs(b,{justify:"center",children:[t("COUPON_UPDATE")&&e.jsx(P,{size:"sm",variant:"ghost",_hover:{background:"none"},onClick:()=>{a(r),n()},icon:e.jsx(oe,{fontSize:18,color:U.colors.blue[500]})}),t("COUPON_DELETE")&&e.jsx(P,{size:"sm",variant:"ghost",_hover:{background:"none"},onClick:()=>{a(r),s()},icon:e.jsx(ne,{fontSize:18,color:U.colors.red[500]})})]})},ke=({id:a,isActive:r})=>{const{hasPermission:s}=w(),n=v(),t=q(),c=async(o,l)=>{let d={id:o,active:l};try{const i=await ee(O.token,"update_coupon",d);i.response===200?(p(n,"success","Updated!"),t.invalidateQueries("coupons"),t.invalidateQueries(["coupons","dashboard"]),t.invalidateQueries(["coupons",o])):p(n,"error",i.message)}catch(i){p(n,"error",JSON.stringify(i))}},h=ye({mutationFn:async o=>{await c(o.id,o.active)}});return e.jsx(m,{display:"flex",alignItems:"center",children:e.jsx(ve,{isDisabled:!s("COUPON_UPDATE"),defaultChecked:r===1,size:"sm",onChange:o=>{let l=o.target.checked?1:0;h.mutate({id:a,active:l})}})})};function qe({isOpen:a,onClose:r,data:s}){const n=v(),t=S.useRef(),c=q(),[h,o]=S.useState(),l=async()=>{let d={id:s.id};try{o(!0);const i=await se(O.token,"delete_coupon_use",d);o(!1),i.response===200?(p(n,"success","Coupon Deleted!"),c.invalidateQueries(["used-coupons"]),r()):p(n,"error",i.message)}catch(i){o(!1),p(n,"error",JSON.stringify(i))}};return e.jsx(ae,{isOpen:a,onClose:r,leastDestructiveRef:t,isCentered:!0,children:e.jsx(T,{children:e.jsxs(ce,{children:[e.jsxs(N,{fontSize:"lg",fontWeight:"semi-bold",children:["Delete Coupon Used for ("," ",e.jsxs("b",{children:[s==null?void 0:s.f_name," ",s==null?void 0:s.l_name]})," ",")"]}),e.jsx(R,{children:"Are you sure? You can not undo this action afterwards."}),e.jsxs(F,{children:[e.jsx(D,{ref:t,onClick:r,colorScheme:"gray",size:"sm",children:"Cancel"}),e.jsx(D,{colorScheme:"red",onClick:l,ml:3,size:"sm",isLoading:h,children:"Delete"})]})]})})})}function we(){const{isOpen:a,onOpen:r,onClose:s}=A(),[n,t]=S.useState(),{hasPermission:c}=w(),{isOpen:h,onOpen:o,onClose:l}=A(),{isOpen:d,onOpen:i,onClose:y}=A(),x=v(),C="Errortoast",L=async()=>{const u=await re(O.token,"get_coupon_use");return u==null?void 0:u.data.map(J=>{const{id:z,coupon_id:W,user_id:H,appointment_id:Y,updated_at:$,f_name:K,l_name:G}=J;return{id:z,coupon_id:W,user_id:H,user_name:`${K} ${G}`,appointment_id:Y,updated_at:$}})},V=u=>{t(u)},{isLoading:M,data:k,error:B}=ie({queryKey:["used-coupons"],queryFn:L}),{handleSearchChange:Q,filteredData:I}=je(k);return B&&(x.isActive(C)||x({id:C,title:"oops!.",description:"Something bad happens.",status:"error",duration:2e3,isClosable:!0,position:"top"})),c("COUPON_VIEW")?e.jsxs(f,{children:[M||!k?e.jsxs(f,{children:[e.jsxs(b,{mb:5,justify:"space-between",children:[e.jsx(_,{w:400,h:8}),e.jsx(_,{w:50,h:8})]}),e.jsx(_,{h:300,w:"100%"})]}):e.jsxs(f,{children:[e.jsx(te,{as:"h1",size:"md",mb:2,children:"Used Coupons"})," ",e.jsx(E,{mb:2}),e.jsxs(b,{mb:5,justify:"space-between",align:"center",children:[e.jsx(j,{size:"md",placeholder:"Search",w:400,maxW:"50vw",onChange:u=>Q(u.target.value)}),c("COUPON_ADD")&&e.jsx(f,{children:e.jsx(D,{size:"sm",colorScheme:"blue",onClick:r,children:"Add New"})})]}),e.jsx(de,{minPad:"8px 8px",data:I,onActionClick:e.jsx(ze,{onClick:V,DeleteonOpen:o,EditonOpen:i})})]}),e.jsx(fe,{isOpen:a,onClose:s}),e.jsx(qe,{isOpen:h,onClose:l,data:n}),d&&e.jsx(me,{isOpen:d,onClose:y,data:n})]}):e.jsx(le,{})}const ze=({onClick:a,rowData:r,DeleteonOpen:s,EditonOpen:n})=>{const{hasPermission:t}=w();return e.jsxs(b,{justify:"center",children:[t("COUPON_UPDATE")&&e.jsx(P,{size:"sm",variant:"ghost",_hover:{background:"none"},onClick:()=>{a(r),n()},icon:e.jsx(oe,{fontSize:18,color:U.colors.blue[500]})}),t("COUPON_DELETE")&&e.jsx(P,{size:"sm",variant:"ghost",_hover:{background:"none"},onClick:()=>{a(r),s()},icon:e.jsx(ne,{fontSize:18,color:U.colors.red[500]})})]})};function $e(){return e.jsx(f,{children:e.jsxs(Se,{children:[e.jsxs(be,{children:[e.jsx(X,{children:"All Coupons"}),e.jsx(X,{children:"Used Coupons"})]}),e.jsxs(Oe,{children:[e.jsx(Z,{px:0,children:e.jsx(Ae,{})}),e.jsx(Z,{px:0,children:e.jsx(we,{})})]})]})})}export{$e as default};
