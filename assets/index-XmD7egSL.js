import{Q as re,r as c,t as ie,E as d,j as e,R as ce,B as f,v as w,F as de,w as D,J as le}from"./index-DLnjnVCu.js";import{e as me}from"./index-DizZbtXV.js";import{u as ue}from"./SettingData-5sbMzAiY.js";import{u as pe,N as he,S as y,i as ge,C as xe,b as n,R as je,D as fe,P as _e,j as Ce,g as De}from"./Dashboard-BVf00d6b.js";import{g as ye}from"./CancellationReqBadge-ClDtE-KR.js";import{A as Se}from"./AddNewAppointment-XJHFswZL.js";import{u as E}from"./HasPermission-Efb43n4z.js";import{g as be}from"./configs-3rp9fq6u.js";import{g as Pe,u as ve}from"./index.esm-CU9MGMRa.js";import{F as o,I as Ye}from"./utils-DHjTyQ2S.js";import{I as Ie}from"./index-CrveBHTj.js";import{B as h}from"./chunk-Z6RXEUPO-CjATnNZs.js";import"./index-DscDBtoO.js";import"./chunk-MGVPL3OH-BhiF1P3g.js";import"./image-BEsbZakN.js";import"./index-Q7d3q0Zt.js";import"./UsePatientsData-Dd382CWd.js";import"./UsersComboBox-DGcvoZQW.js";import"./popover-Bdb83bZr.js";import"./useMutation-CH8xzEHB.js";import"./swiper-react-DUABaiBA.js";import"./chunk-JARCRF6W-CtmXHheL.js";import"./AddPatients-Cyv477UK.js";import"./IsdModal-DvHKxEmI.js";import"./chunk-FKYN3ZGE-BIoTHd0a.js";import"./today-D_vLUvRX.js";import"./chunk-3RSXBRAN-DjkGz0-1.js";import"./chunk-YQO7BFFX-DeFCmj0r.js";import"./chunk-Z3VR2BFQ-Dh96I6nM.js";const $e=(l,t)=>{const r=(l-1)*t;let m=r+t-1;return{startIndex:r,endIndex:m}},Ae=d().subtract(Ce,"days").format("YYYY-MM-DD"),Me=d().format("YYYY-MM-DD");function dt(){const l=re(),{isOpen:t,onOpen:r,onClose:m}=Pe(),S=ve(),b="Errortoast",[u,T]=c.useState(1),_=c.useRef(null),[P,N]=c.useState(""),g=pe(P,1e3),[p,B]=c.useState([]),{startIndex:v,endIndex:Y}=$e(u,50),{hasPermission:I}=E(),F=ie(),[x,z]=c.useState({startDate:Ae,endDate:Me}),$=d(x.startDate).format("YYYY-MM-DD"),A=d(x.endDate).format("YYYY-MM-DD"),Q=s=>{B(s)},O=async()=>{const s=D.role.name==="Doctor"?`get_appointments/doctor_id/page?start=${v}&end=${Y}&doctor_id=${D.id}&search=${g}&start_date=${$}&end_date=${A}&status=${p.join(", ")}`:`get_appointments/page?start=${v}&end=${Y}&search=${g}&start_date=${$}&end_date=${A}&status=${p.join(", ")}`;await be();const i=await le(D.token,s);return{data:i==null?void 0:i.data.map(W=>{const{id:J,patient_id:K,status:R,date:U,time_slots:X,type:C,payment_status:j,current_cancel_req_status:k,patient_f_name:Z,patient_l_name:ee,patient_phone:te,doct_f_name:se,doct_l_name:ae,doct_image:ne,source:oe}=W;return{id:J,image:ne,Doctor:`${se} ${ae}`,Patient:`${Z} ${ee} - #${K}`,phone:te,Status:De(R),Date:d(U).format("DD MMM YYYY"),"Time Slots":d(X,"HH:mm:ss").format("hh:mm A"),Type:C==="Emergency"?e.jsx(h,{colorScheme:"red",children:C}):e.jsx(h,{colorScheme:"green",children:C}),"Payment Status":j==="Paid"?e.jsx(h,{colorScheme:"green",children:j}):j==="Refunded"?e.jsx(h,{colorScheme:"blue",children:j}):e.jsx(h,{colorScheme:"red",children:"Not Paid"}),"Cancellation Status":ye(k),source:oe,filterStatus:R,current_cancel_req_status:k}}),total_record:i.total_record}},{isLoading:q,data:a,error:M,isFetching:V,isRefetching:H}=ue({queryKey:["appointments",u,g,p,x],queryFn:O}),G=s=>{T(s)},L=Math.ceil((a==null?void 0:a.total_record)/50);return c.useEffect(()=>{_.current&&_.current.scrollIntoView({behavior:"smooth",block:"start"})},[u]),M?(S.isActive(b)||S({id:b,title:"Oops!",description:"Something bad happened.",status:"error",duration:2e3,isClosable:!0,position:"top"}),e.jsx(ce,{errorCode:M.name})):I("APPOINTMENT_VIEW")?e.jsxs(f,{ref:_,children:[q||!a?e.jsxs(f,{children:[e.jsxs(o,{mb:5,justify:"space-between",children:[e.jsx(y,{w:400,h:8}),e.jsx(y,{w:200,h:8})]}),[...Array(10)].map((s,i)=>e.jsx(y,{h:10,w:"100%",mt:2},i))]}):e.jsxs(f,{children:[e.jsxs(o,{mb:5,justify:"space-between",align:"center",children:[e.jsxs(o,{align:"center",gap:4,children:[e.jsx(Ye,{size:"md",placeholder:"Search",w:400,maxW:"50vw",onChange:s=>N(s.target.value),value:P}),e.jsx(ge,{dateRange:x,setDateRange:z,size:"md"})]}),e.jsx(f,{children:e.jsx(w,{size:"sm",colorScheme:"blue",onClick:()=>{r()},isDisabled:!I("APPOINTMENT_ADD"),children:"Add New"})})]}),e.jsxs(o,{alignItems:"top",justifyContent:"space-between",children:[" ",e.jsx(xe,{colorScheme:"blue",onChange:Q,value:p,children:e.jsxs(o,{mb:5,gap:4,alignItems:"center",children:[e.jsx(n,{value:"Confirmed",children:"Confirmed"}),e.jsx(n,{value:"Visited",children:"Visited"}),e.jsx(n,{value:"Completed",children:"Completed"}),e.jsx(n,{value:"Pending",children:"Pending"}),e.jsx(n,{value:"Cancelled",children:"Cancelled"}),e.jsx(n,{value:"Rejected",children:"Rejected"}),e.jsx(n,{value:"Cancellation",children:"Cancellation Initiated"})]})})," ",e.jsx(w,{isLoading:V||H,size:"sm",colorScheme:"blue",onClick:()=>{F.invalidateQueries(["appointments",u,g,p],{refetchInactive:!0})},rightIcon:e.jsx(je,{size:14}),children:"Refresh Table"})]}),e.jsx(fe,{minPad:"1px 10px",data:a==null?void 0:a.data,onActionClick:e.jsx(Re,{onClick:()=>{},navigate:l})})]}),e.jsx(o,{justify:"center",mt:4,children:e.jsx(_e,{currentPage:u,onPageChange:G,totalPages:L})}),t&&e.jsx(Se,{isOpen:t,onClose:m})]}):e.jsx(he,{})}const Re=({onClick:l,rowData:t,navigate:r})=>{const{hasPermission:m}=E();return e.jsx(o,{justify:"center",children:m("APPOINTMENT_UPDATE")&&e.jsx(Ie,{size:"sm",variant:"ghost",_hover:{background:"none"},onClick:()=>{l(t),r(`/appointment/${t.id}`)},icon:e.jsx(me,{fontSize:18,color:de.colors.blue[500]})})})};export{dt as default};
