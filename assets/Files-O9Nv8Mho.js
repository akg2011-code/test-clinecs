import{r,t as le,j as e,B as u,T as B,N as ce,O as de,v as O,P as ue,w as U,E as _,R as me,F as R,J as xe}from"./index-DLnjnVCu.js";import{e as he,f as fe}from"./index-DizZbtXV.js";import{u as pe}from"./SettingData-5sbMzAiY.js";import{F as je}from"./index-DscDBtoO.js";import{u as q}from"./HasPermission-Efb43n4z.js";import{V as ge,u as De,N as ye,S as A,i as Fe,D as be,P as Ce,j as _e}from"./Dashboard-BVf00d6b.js";import{U as Se,D as Pe}from"./DeletePatientFile-ALgrFW-j.js";import{i as Ee}from"./image-BEsbZakN.js";import{a as Me,I as $}from"./index-CrveBHTj.js";import{i as ke,u as ve,M as Ae,b as Ie,a as Oe,c as Ye,h as ze,d as Le,F as N,e as we,f,g as I,L as Be}from"./index.esm-CU9MGMRa.js";import{u as Re}from"./UsePatientsData-Dd382CWd.js";import{U as $e}from"./UsersComboBox-DGcvoZQW.js";import{D as T}from"./index-Q7d3q0Zt.js";import{b as Q,I as Y,F as y}from"./utils-DHjTyQ2S.js";import"./chunk-MGVPL3OH-BhiF1P3g.js";import"./chunk-Z6RXEUPO-CjATnNZs.js";import"./popover-Bdb83bZr.js";function Ne({isOpen:o,onClose:t}){const[i,l]=r.useState(),[c,m]=r.useState(null),p=r.useRef(),{register:S,handleSubmit:P,reset:F}=ke(),b=le(),d=ve(),x=5*1024*1024,{patientsData:E}=Re(),[j,M]=r.useState(),C=n=>{n.preventDefault();const s=n.dataTransfer.files[0];s&&s.size>x?f(d,"error","Please select a file smaller than 5 MB."):m(s)},g=n=>{n.preventDefault()},k=n=>{const s=n.target.files[0];s&&s.size>x?f(d,"error","Please select a file smaller than 5 MB."):m(s)},v=async n=>{if(!j)return f(d,"error","Please Select Patient");if(!c)return f(d,"error","Please Select File");let s={...n,patient_id:j.id,file:c};try{l(!0);const h=await ue(U.token,"add_patient_file",s);l(!1),h.response===200?(f(d,"success","File Added!"),b.invalidateQueries(["patient-files",j.id]),b.invalidateQueries(["all-files"]),m(null),F(),t()):f(d,"error",h.message)}catch(h){l(!1),f(d,"error",JSON.stringify(h))}};return e.jsxs(Ae,{isOpen:o,onClose:t,isCentered:!0,size:"lg",children:[e.jsx(Ie,{}),e.jsxs(Oe,{as:"form",onSubmit:P(v),children:[e.jsx(Ye,{fontSize:18,py:2,children:"Add Patient Files"}),e.jsx(ze,{}),e.jsx(T,{}),e.jsx(Le,{children:e.jsxs(u,{pb:3,children:[e.jsxs(Q,{isRequired:!0,children:[e.jsx(N,{children:"Patient"}),e.jsx($e,{data:E,name:"Patient",setState:M,addNew:!1})]}),e.jsxs(Q,{isRequired:!0,mt:5,children:[e.jsx(N,{children:"File Name"}),e.jsx(Y,{placeholder:"Name",...S("file_name",{required:!0})})]}),e.jsx(u,{mt:5,p:4,border:"2px dashed",borderColor:"gray.300",borderRadius:"md",onDrop:C,onDragOver:g,onClick:()=>{p.current&&p.current.click()},cursor:"pointer",children:c?e.jsxs(u,{position:"relative",children:[e.jsxs(B,{children:["Selected File: ",c.name]}),e.jsx(ce,{position:"absolute",right:-2,top:-2,size:"sm",onClick:()=>{m(null)}})]}):e.jsxs(u,{children:[e.jsxs(ge,{children:[" ",e.jsx(Y,{ref:p,type:"file",onChange:k,accept:"*",mb:4})]}),e.jsxs(de,{children:[" ",e.jsx(Me,{fontSize:32})]}),e.jsxs(B,{textAlign:"center",mt:3,children:[e.jsx("b",{children:"Choose a file"})," or Drag it here.",e.jsx("br",{}),"Max 5 MB"]})]})})]})}),e.jsx(T,{}),e.jsxs(we,{py:3,children:[e.jsx(O,{colorScheme:"gray",mr:3,onClick:t,size:"sm",children:"Close"}),e.jsx(O,{variant:"solid",size:"sm",colorScheme:"blue",type:"submit",isLoading:i,children:"Add File"})]})]})]})}const Te=(o,t)=>{const i=(o-1)*t;let l=i+t-1;return{startIndex:i,endIndex:l}},Qe=_().subtract(_e,"days").format("YYYY-MM-DD"),Ue=_().format("YYYY-MM-DD");function cs(){const[o,t]=r.useState(),{isOpen:i,onOpen:l,onClose:c}=I(),{hasPermission:m}=q(),{isOpen:p,onOpen:S,onClose:P}=I(),{isOpen:F,onOpen:b,onClose:d}=I(),[x,E]=r.useState(1),[j,M]=r.useState(""),C=De(j,1e3),[g,k]=r.useState({startDate:Qe,endDate:Ue}),{startIndex:v,endIndex:n}=Te(x,50),s=r.useRef(null),h=_(g.startDate).format("YYYY-MM-DD"),z=_(g.endDate).format("YYYY-MM-DD"),V=a=>{t(a)},H=async()=>{const a=await xe(U.token,`get_patient_file_page?start=${v}&end=${n}&search=${C}&start_date=${h}&end_date=${z}`);return{data:a==null?void 0:a.data.map(K=>{const{id:X,patient_id:Z,file_name:ee,file:se,f_name:te,l_name:ae,phone:ne,isd_code:re,updated_at:oe,created_at:ie}=K;return{id:X,patient_id:Z,"file name":e.jsxs(Be,{isExternal:!0,href:`${Ee}/${se}`,display:"flex",alignItems:"center",gap:3,children:[ee," ",e.jsx(fe,{})]}),patient_Name:`${te} ${ae}`,phone:`${re}${ne}`,created_at:ie,updated_at:oe}}),total_record:a.total_record}},{data:D,isLoading:J,error:L}=pe({queryKey:["all-files",C,x,h,z],queryFn:H}),W=a=>{E(a)},G=Math.ceil((D==null?void 0:D.total_record)/50);return r.useEffect(()=>{s.current&&s.current.scrollIntoView({behavior:"smooth",block:"start"})},[x]),L?e.jsx(me,{errorCode:L.name}):m("FILE_VIEW")?e.jsxs(u,{ref:s,children:[J||!D?e.jsxs(u,{children:[e.jsxs(y,{mb:5,justify:"space-between",children:[e.jsx(A,{w:400,h:8}),e.jsx(A,{w:200,h:8})]}),[...Array(10)].map((a,w)=>e.jsx(A,{h:10,w:"100%",mt:2},w))]}):e.jsxs(u,{children:[e.jsxs(y,{mb:5,justify:"space-between",align:"center",children:[e.jsxs(y,{align:"center",gap:4,children:[e.jsx(Y,{size:"md",placeholder:"Search",w:400,maxW:"50vw",onChange:a=>M(a.target.value),value:j}),e.jsx(Fe,{dateRange:g,setDateRange:k,size:"md"})]}),e.jsx(u,{children:e.jsx(O,{isDisabled:!m("FILE_ADD"),size:"sm",colorScheme:"blue",onClick:l,children:"Add New"})})]}),e.jsx(be,{minPad:"8px 8px",data:D.data,onActionClick:e.jsx(qe,{onClick:V,DeleteonOpen:b,EditonOpen:S})}),e.jsx(y,{justify:"center",mt:4,children:e.jsx(Ce,{currentPage:x,onPageChange:W,totalPages:G})})]}),i&&e.jsx(Ne,{isOpen:i,onClose:c}),p&&e.jsx(Se,{isOpen:p,onClose:P,data:o}),F&&e.jsx(Pe,{isOpen:F,onClose:d,data:o})]}):e.jsx(ye,{})}const qe=({onClick:o,rowData:t,DeleteonOpen:i,EditonOpen:l})=>{const{hasPermission:c}=q();return e.jsxs(y,{justify:"center",children:[c("FILE_UPDATE")&&e.jsx($,{size:"sm",variant:"ghost",_hover:{background:"none"},onClick:()=>{o(t),l()},icon:e.jsx(he,{fontSize:18,color:R.colors.blue[500]})}),c("FILE_DELETE")&&e.jsx($,{size:"sm",variant:"ghost",_hover:{background:"none"},onClick:()=>{o(t),i()},icon:e.jsx(je,{fontSize:18,color:R.colors.red[500]})})]})};export{cs as default};
