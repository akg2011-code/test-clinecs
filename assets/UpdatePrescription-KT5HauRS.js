import{ax as K,Q as X,t as Y,af as Z,r as b,j as e,U as ee,B as T,H as p,v as f,C as g,av as se,w as k,G as ie,J as te}from"./index-DLnjnVCu.js";import{B as ne,l as ae}from"./HasPermission-Efb43n4z.js";import{i as re}from"./index-DoPvV33R.js";import{u as oe}from"./SettingData-5sbMzAiY.js";import{u as le}from"./useMutation-CH8xzEHB.js";import{u as de,M as ce}from"./MedicineAutocomplete-CD_T5QRC.js";import{i as me,u as ue,g as he,F as i,f as z}from"./index.esm-CU9MGMRa.js";import{A as xe}from"./AddMedicine-J2vEtrpC.js";import{F as d,b as t,I as l}from"./utils-DHjTyQ2S.js";import{C as w,a as _}from"./chunk-YQO7BFFX-DeFCmj0r.js";import{D as M}from"./index-Q7d3q0Zt.js";import{H as je,T as C}from"./Dashboard-BVf00d6b.js";import{S as y}from"./chunk-3RSXBRAN-DjkGz0-1.js";import{I as A}from"./index-CrveBHTj.js";import"./button-BU2rN6Gn.js";import"./popover-Bdb83bZr.js";import"./index-DscDBtoO.js";import"./chunk-MGVPL3OH-BhiF1P3g.js";import"./image-BEsbZakN.js";import"./chunk-Z6RXEUPO-CjATnNZs.js";function pe(m){return m.some(v=>Object.entries(v).some(([r,h])=>r!=="notes"&&(h===null||h===""||h===void 0)))}function Oe(){const{id:m}=K(),v=X(),{register:r,getValues:h}=me(),V=Y(),[F]=Z(),P=F.get("appointmentID"),I=F.get("patientID"),x=ue(),{isOpen:E,onOpen:O,onClose:U}=he(),{medicinesData:H}=de(),N=async()=>(await te(k.token,`get_prescription/${m}`)).data,{data:s,isLoading:Q}=oe({queryKey:["prescription",m],queryFn:N}),[c,j]=b.useState((s==null?void 0:s.items)||[]),[q,L]=b.useState({medicine_name:"",dosage:"",duration:"",time:"",dose_interval:"",notes:""});b.useEffect(()=>{j((s==null?void 0:s.items)||[{medicine_name:"",dosage:"",duration:"",time:"",dose_interval:"",notes:""}])},[s]);const u=(o,n,a)=>{console.log(n,a,c),j(S=>S.map((B,W)=>W===o?{...B,[n]:a}:B))},$=()=>{j([...c,q]),L({medicine_name:"",dosage:"",duration:"",time:"",dose_interval:"",notes:""})},G=o=>{j(n=>n.filter((a,S)=>S!==o))},J=async()=>{if(pe(c))return z(x,"error","Please fill all the medicine details");const o=h();console.log(o);const n={...o,id:m,appointment_id:P,patient_id:I,medicines:c};try{const a=await se(k.token,"update_prescription",n);a.response===200?z(x,"success","Patient Updated!"):z(x,"error",a.message)}catch(a){z(x,"error",JSON.stringify(a))}},D=le({mutationFn:async()=>{await J()},onSuccess:()=>{V.invalidateQueries(["prescription",m]),V.invalidateQueries(["prescriptios",P])}}),R=()=>{const o=`${ie}/prescription/generatePDF/${m}`,n=window.open(o,"_blank");n&&(n.focus(),n.onload=()=>{n.load(),n.onafterprint=()=>{n.close()}})};return Q||D.isPending?e.jsx(ee,{}):e.jsxs(T,{children:[e.jsxs(d,{justify:"space-between",alignItems:"center",children:[e.jsx(p,{as:"h1",size:"md",children:"Update Prescription"}),e.jsx(f,{w:120,size:"sm",variant:g("blackButton","gray"),onClick:()=>{v(-1)},children:"Back"})]}),e.jsxs(T,{children:[" ",e.jsx(w,{mt:5,bg:g("white","gray.700"),children:e.jsxs(_,{p:3,as:"form",children:[e.jsxs(d,{justify:"space-between",children:[" ",e.jsx(p,{as:"h3",size:"sm",children:"Medicines -"})," ",e.jsxs(d,{gap:3,children:[" ",e.jsx(f,{size:"sm",colorScheme:"facebook",onClick:R,leftIcon:e.jsx(ne,{fontSize:18}),children:"Print"})," ",e.jsx(f,{size:"sm",colorScheme:"blue",onClick:O,children:"New Medicine"})]})]}),e.jsx(M,{mt:2,mb:5}),c.map((o,n)=>e.jsxs(je,{spacing:4,w:"full",mb:5,align:"flex-end",children:[e.jsxs(t,{children:[e.jsx(i,{fontSize:"sm",mb:0,children:"Medicine"}),e.jsx(ce,{name:"Medicine",data:H,defaultName:o.medicine_name,handleChange:u,mainIndex:n})]}),e.jsxs(t,{w:"150px",children:[e.jsx(i,{fontSize:"sm",mb:0,children:"Dosage"}),e.jsx(y,{name:"dosage",value:o.dosage,onChange:a=>u(n,"dosage",a.target.value),size:"md",placeholder:"Select",children:[1,2,3,4,5,6,7,8,9,10].map(a=>e.jsx("option",{value:a,children:a},a))})]}),e.jsxs(t,{children:[e.jsx(i,{fontSize:"sm",mb:0,children:"Duration"}),e.jsxs(y,{name:"duration",value:o.duration,onChange:a=>u(n,"duration",a.target.value),size:"md",placeholder:"Select",children:[e.jsx("option",{value:"For 3 days",children:"For 3 days"}),e.jsx("option",{value:"For 5 days",children:"For 5 days"}),e.jsx("option",{value:"For 7 days",children:"for 7 days"}),e.jsx("option",{value:"For 105days",children:"for 15 days"}),e.jsx("option",{value:"For 1 Month",children:"for 1 Month"})]})]}),e.jsxs(t,{children:[e.jsx(i,{fontSize:"sm",mb:0,children:"Time"}),e.jsxs(y,{size:"md",name:"time",value:o.time,onChange:a=>u(n,"time",a.target.value),placeholder:"Select",children:[e.jsx("option",{value:"After Meal",children:"After Meal"}),e.jsx("option",{value:"Before Meal",children:"Before Meal"})]})]}),e.jsxs(t,{children:[e.jsx(i,{fontSize:"sm",mb:0,children:"Dose Interval"}),e.jsxs(y,{size:"md",name:"dose_interval",value:o.dose_interval,onChange:a=>u(n,"dose_interval",a.target.value),placeholder:"Select",children:[" ",e.jsx("option",{value:"Once a Day",children:"Once a Day"}),e.jsx("option",{value:"Every Morning & Evening",children:"Every Morning & Evening"}),e.jsx("option",{value:"3 Times a day",children:"3 Times a day"}),e.jsx("option",{value:"4 Times a day",children:"4 Times a day"})]})]}),e.jsxs(t,{children:[e.jsx(i,{fontSize:"sm",mb:0,children:"Notes"}),e.jsx(l,{size:"md",name:"notes",value:o.notes,onChange:a=>u(n,"notes",a.target.value)})]})," ",e.jsxs(d,{mb:"2px",gap:3,children:[e.jsx(A,{size:"sm",colorScheme:"blue",icon:e.jsx(ae,{fontSize:20}),onClick:$}),(c==null?void 0:c.length)>1&&e.jsx(A,{size:"sm",colorScheme:"red",icon:e.jsx(re,{}),onClick:()=>{G(n)}})]})]},n))]})}),e.jsx(w,{mt:5,bg:g("white","gray.700"),children:e.jsxs(_,{p:3,as:"form",children:[e.jsxs(d,{justify:"space-between",children:[" ",e.jsx(p,{as:"h3",size:"sm",children:"Physical Details -"})," "]}),e.jsx(M,{mt:2,mb:5}),e.jsxs(d,{flexWrap:"wrap",gap:5,children:[e.jsxs(t,{mt:3,w:"300px",children:[e.jsx(i,{fontSize:"sm",children:"Food Allergies"}),e.jsx(l,{size:"md",...r("food_allergies"),defaultValue:s.food_allergies})]}),e.jsxs(t,{mt:3,w:"300px",children:[e.jsx(i,{fontSize:"sm",children:"Tendency to Bleed"}),e.jsx(l,{size:"md",...r("tendency_bleed"),defaultValue:s.tendency_bleed})]}),e.jsxs(t,{mt:3,w:"300px",children:[e.jsx(i,{fontSize:"sm",children:"Heart Disease"}),e.jsx(l,{size:"md",...r("heart_disease"),defaultValue:s.heart_disease})]}),e.jsxs(t,{mt:3,w:"300px",children:[e.jsx(i,{fontSize:"sm",children:"Blood Pressure"}),e.jsx(l,{size:"md",...r("blood_pressure"),defaultValue:s.blood_pressure})]}),e.jsxs(t,{mt:3,w:"300px",children:[e.jsx(i,{fontSize:"sm",children:"Diabetic"}),e.jsx(l,{size:"md",...r("diabetic"),defaultValue:s.diabetic})]}),e.jsxs(t,{mt:3,w:"300px",children:[e.jsx(i,{fontSize:"sm",children:"Surgery"}),e.jsx(l,{size:"md",...r("surgery"),defaultValue:s.surgery})]}),e.jsxs(t,{mt:3,w:"300px",children:[e.jsx(i,{fontSize:"sm",children:"Accident"}),e.jsx(l,{size:"md",...r("accident"),defaultValue:s.accident})]}),e.jsxs(t,{mt:3,w:"300px",children:[e.jsx(i,{fontSize:"sm",children:"Others"}),e.jsx(l,{size:"md",...r("others"),defaultValue:s.others})]}),e.jsxs(t,{mt:3,w:"300px",children:[e.jsx(i,{fontSize:"sm",children:"Medical History"}),e.jsx(l,{size:"md",...r("medical_history"),defaultValue:s.medical_history})]}),e.jsxs(t,{mt:3,w:"300px",children:[e.jsx(i,{fontSize:"sm",children:"Current Medication"}),e.jsx(l,{size:"md",...r("current_medication"),defaultValue:s.current_medication})]}),e.jsxs(t,{mt:3,w:"300px",children:[e.jsx(i,{fontSize:"sm",children:"Female Pregnancy"}),e.jsx(l,{size:"md",...r("female_pregnancy"),defaultValue:s.female_pregnancy})]}),e.jsxs(t,{mt:3,w:"300px",children:[e.jsx(i,{fontSize:"sm",children:"Breast Feeding"}),e.jsx(l,{size:"md",...r("breast_feeding"),defaultValue:s.breast_feeding})]}),e.jsxs(t,{mt:3,w:"300px",children:[e.jsx(i,{fontSize:"sm",children:"Pulse Rate"}),e.jsx(l,{size:"md",...r("pulse_rate"),defaultValue:s.pulse_rate})]}),e.jsxs(t,{mt:3,w:"300px",children:[e.jsx(i,{fontSize:"sm",children:"Temperature"}),e.jsx(l,{size:"md",...r("temperature"),defaultValue:s.temperature})]})]})]})}),e.jsx(w,{mt:5,bg:g("white","gray.700"),children:e.jsxs(_,{p:3,as:"form",children:[e.jsxs(d,{justify:"space-between",children:[" ",e.jsx(p,{as:"h3",size:"sm",children:"Other -"})," "]}),e.jsx(M,{mt:2,mb:5}),e.jsxs(t,{children:[e.jsx(i,{fontSize:"md",mb:1,children:"Problem -"}),e.jsx(C,{height:100,...r("problem_desc"),defaultValue:s.problem_desc})]}),e.jsxs(t,{children:[e.jsx(i,{fontSize:"md",mb:1,children:"Test -"}),e.jsx(C,{height:100,...r("tests"),defaultValue:s.test})]}),e.jsxs(t,{mt:4,children:[e.jsx(i,{fontSize:"md",mb:1,children:"Advise -"}),e.jsx(C,{height:100,...r("advice"),defaultValue:s.advice})]}),e.jsxs(t,{mt:4,children:[e.jsx(i,{fontSize:"md",mb:1,children:"Next Visit -"}),e.jsxs(d,{gap:5,alignItems:"center",children:["After",e.jsx(l,{w:16,type:"number",...r("next_visit"),min:1,defaultValue:s.next_visit}),"Days"]})]})]})}),e.jsx(d,{w:"100%",justify:"end",mt:5,children:e.jsx(f,{w:96,colorScheme:"green",size:"sm",onClick:()=>{D.mutate()},children:"Save"})})]}),e.jsx(xe,{isOpen:E,onClose:U})]})}export{Oe as default};
