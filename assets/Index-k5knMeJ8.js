import{r as s,E as o,j as e,B as x,G as me,F as pe,w as g,J as Z,L as j}from"./index-DLnjnVCu.js";import{e as xe}from"./index-DizZbtXV.js";import{u as ee}from"./SettingData-5sbMzAiY.js";import{u as te,N as ne,S as f,i as ae,D as se,P as oe,j as re,c as _e,d as ge,e as J,f as je,h as U}from"./Dashboard-BVf00d6b.js";import{T as he,p as fe}from"./printPDF-B0J1mAQL.js";import{u as ce}from"./HasPermission-Efb43n4z.js";import{u as ie}from"./index.esm-CU9MGMRa.js";import{F as l,I as de}from"./utils-DHjTyQ2S.js";import{I as le}from"./index-CrveBHTj.js";import{B as X}from"./chunk-Z6RXEUPO-CjATnNZs.js";import"./index-DscDBtoO.js";import"./chunk-MGVPL3OH-BhiF1P3g.js";import"./image-BEsbZakN.js";import"./index-Q7d3q0Zt.js";const De=(n,t)=>{const r=(n-1)*t;let a=r+t-1;return{startIndex:r,endIndex:a}},ue="Errortoast",$e=o().subtract(re,"days").format("YYYY-MM-DD"),Ye=o().format("YYYY-MM-DD");function ye(){const[n,t]=s.useState(),{hasPermission:r}=ce(),a=ie(),[c,w]=s.useState(1),_=s.useRef(null),[v,D]=s.useState(""),u=te(v,1e3),[$,b]=s.useState({startDate:$e,endDate:Ye}),Y=o($.startDate).format("YYYY-MM-DD"),M=o($.endDate).format("YYYY-MM-DD"),{startIndex:A,endIndex:m}=De(c,50),R=async()=>{const p=g.role.name==="Doctor"?`get_invoices/page?start=${A}&end=${m}&search=${u}&start_date=${Y}&end_date=${M}&doctor_id=${g.id}`:`get_invoices/page?start=${A}&end=${m}&search=${u}&start_date=${Y}&end_date=${M}`,y=await Z(g.token,p);return{data:y==null?void 0:y.data.map(F=>{const{id:k,user_id:S,patient_id:Q,appointment_id:C,status:L,total_amount:V,invoice_date:W,created_at:q,patient_f_name:T,patient_l_name:O,user_f_name:N,user_l_name:E,coupon_title:G,coupon_value:K,coupon_off_amount:H}=F;return{id:k,status:L,total_Amount:V,applied_coupon:G||"N/A","coupon value (%)":K||"N/A",coupon_off_amount:H||0,invoice_Date:o(W).format("D MMM YY"),patient:T?e.jsx(j,{to:`/patient/${Q}`,children:`${T} ${O}`}):"N/A",user:S?e.jsx(j,{to:`/user/${S}`,children:`${N} ${E}`}):"N/A",appointmentID:e.jsx(j,{to:`/appointment/${C}`,children:C}),createdAt:o(q).format("D MMM YY hh:mmA")}}),total_record:y.total_record}},z=p=>{t(p)},{isLoading:h,data:i,error:P}=ee({queryKey:["invoices",c,u,$],queryFn:R}),B=p=>{w(p)},d=Math.ceil((i==null?void 0:i.total_record)/50);return P&&(a.isActive(ue)||a({id:ue,title:"oops!",description:"Something bad happens.",status:"error",duration:2e3,isClosable:!0,position:"top"})),s.useEffect(()=>{_.current&&_.current.scrollIntoView({behavior:"smooth",block:"start"})},[c]),r("APPOINTMENT_INVOICE_VIEW")?e.jsxs(x,{ref:_,children:[h||!i?e.jsxs(x,{children:[e.jsxs(l,{mb:5,justify:"space-between",children:[e.jsx(f,{w:400,h:8}),e.jsx(f,{w:50,h:8})]}),e.jsx(f,{h:300,w:"100%"})]}):e.jsxs(x,{children:[e.jsx(l,{mb:5,justify:"space-between",align:"center",children:e.jsxs(l,{align:"center",gap:4,children:[e.jsx(de,{size:"md",placeholder:"Search",w:400,maxW:"50vw",onChange:p=>D(p.target.value)}),e.jsx(ae,{dateRange:$,setDateRange:b,size:"md"})]})}),e.jsx(se,{data:i==null?void 0:i.data,onActionClick:e.jsx(be,{rowData:n,onClick:z})})]}),e.jsx(l,{justify:"center",mt:4,children:e.jsx(oe,{currentPage:c,onPageChange:B,totalPages:d})})]}):e.jsx(ne,{})}const be=({onClick:n,rowData:t})=>{const r=a=>{const c=window.open(a,"_blank");c&&(c.focus(),c.onload=()=>{c.load(),c.onafterprint=()=>{c.close()}})};return e.jsx(l,{justify:"center",children:e.jsx(le,{size:"sm",variant:"ghost",_hover:{background:"none"},onClick:()=>{n(t),r(`${me}/invoice/generatePDF/${t.id}`)},icon:e.jsx(he,{fontSize:18,color:pe.colors.blue[500]})})})},Me=o().subtract(re,"days").format("YYYY-MM-DD"),Ae=o().format("YYYY-MM-DD"),Ie=(n,t)=>{const r=(n-1)*t;let a=r+t-1;return{startIndex:r,endIndex:a}};function Se(){const{hasPermission:n}=ce(),[t,r]=s.useState(),[a,c]=s.useState(1),w=s.useRef(null),[_,v]=s.useState(""),D=te(_,1e3),[u,$]=s.useState({startDate:Me,endDate:Ae}),b=o(u.startDate).format("YYYY-MM-DD"),Y=o(u.endDate).format("YYYY-MM-DD"),M=ie(),A="Errortoast",m=async()=>{const{startIndex:d,endIndex:p}=Ie(a,50),y=g.role.name==="Doctor"?`get_appointment_payments/page?start=${d}&end=${p}&search=${D}&start_date=${b}&end_date=${Y}&doctor_id=${g.id}`:`get_appointment_payments/page?start=${d}&end=${p}&search=${D}&start_date=${b}&end_date=${Y}`,I=await Z(g.token,y);return{data:I==null?void 0:I.data.map(k=>{const{id:S,txn_id:Q,invoice_id:C,amount:L,payment_time_stamp:V,payment_method:W,created_at:q,user_id:T,patient_id:O,appointment_id:N,patient_f_name:E,patient_l_name:G,user_f_name:K,user_l_name:H}=k;return{id:S,"txn ID":Q,invoiceID:C,patient:E?e.jsx(j,{to:`/patient/${O}`,children:`${E} ${G}`}):"N/A",user:K?e.jsx(j,{to:`/user/${T}`,children:`${K} ${H}`}):"N/A","APP ID":e.jsx(j,{to:`/appointment/${N}`,children:N}),amount:L,"payment Method":W,"payment Time stamp":o(V).format("D MMM YY hh.mmA"),"created At":o(q).format("D MMM YY hh:mmA")}}),total_record:I.total_record}},R=d=>{r(d)},{isLoading:z,data:h,error:i}=ee({queryKey:["appointment-payments",a,D,u],queryFn:m}),P=d=>{c(d)},B=Math.ceil((h==null?void 0:h.total_record)/50);return s.useEffect(()=>{w.current&&w.current.scrollIntoView({behavior:"smooth",block:"start"})},[a]),i&&(M.isActive(A)||M({id:A,title:"oops!.",description:"Something bad happens.",status:"error",duration:2e3,isClosable:!0,position:"top"})),n("APPOINTMENT_PAYMENTS_VIEW")?e.jsxs(x,{children:[z||!h?e.jsxs(x,{children:[e.jsxs(l,{mb:5,justify:"space-between",children:[e.jsx(f,{w:400,h:8}),e.jsx(f,{w:50,h:8})]}),e.jsx(f,{h:300,w:"100%"})]}):e.jsxs(x,{children:[e.jsx(l,{mb:5,justify:"space-between",align:"center",children:e.jsxs(l,{align:"center",gap:4,children:[" ",e.jsx(de,{size:"md",placeholder:"Search",w:400,maxW:"50vw",onChange:d=>v(d.target.value)}),e.jsx(ae,{dateRange:u,setDateRange:$,size:"md"})]})}),e.jsx(se,{data:h?h.data:[],onActionClick:e.jsx(we,{onClick:R,rowData:t})})]}),e.jsx(l,{justify:"center",mt:4,children:e.jsx(oe,{currentPage:a,onPageChange:P,totalPages:B})})]}):e.jsx(ne,{})}const we=({onClick:n,rowData:t})=>e.jsx(l,{justify:"center",children:e.jsx(le,{size:"sm",variant:"ghost",_hover:{background:"none"},onClick:()=>{n(t),fe(`${me}/invoice/generatePDF/${t.invoiceID}`)},icon:e.jsx(he,{fontSize:18,color:pe.colors.blue[500]})})}),ve=n=>{switch(n){case"Credited":return e.jsx(X,{colorScheme:"green",fontSize:12,letterSpacing:.5,p:"5px",size:"sm",children:"Credited"});case"Debited":return e.jsx(X,{colorScheme:"red",fontSize:12,letterSpacing:.5,p:"5px",children:"Debited"});default:return e.jsx(X,{colorScheme:"yellow",fontSize:12,letterSpacing:.5,p:"5px",children:"N/A"})}};function Je(){return e.jsx(x,{children:e.jsxs(_e,{children:[e.jsxs(ge,{children:[e.jsx(J,{children:"All Transactions"}),e.jsx(J,{children:"Appointment Payments"}),e.jsx(J,{children:"Invoices"})]}),e.jsxs(je,{children:[e.jsx(U,{children:e.jsx(Te,{})}),e.jsx(U,{children:e.jsx(Se,{})}),e.jsx(U,{children:e.jsx(ye,{})})]})]})})}const Pe=(n,t)=>{const r=(n-1)*t;let a=r+t-1;return{startIndex:r,endIndex:a}},ke=o().subtract(re,"days").format("YYYY-MM-DD"),Ce=o().format("YYYY-MM-DD");function Te(){const{hasPermission:n}=ce(),[t,r]=s.useState(1),a=s.useRef(null),[c,w]=s.useState(""),_=te(c,1e3),v=ie(),D="Errortoast",[u,$]=s.useState({startDate:ke,endDate:Ce}),b=o(u.startDate).format("YYYY-MM-DD"),Y=o(u.endDate).format("YYYY-MM-DD"),M=async()=>{const{startIndex:i,endIndex:P}=Pe(t,50),B=g.role.name==="Doctor"?`get_all_transactions/doctor_id/page?start=${i}&end=${P}&search=${_}&start_date=${b}&end_date=${Y}&doctor_id=${g.id}`:`get_all_transactions/page?start=${i}&end=${P}&search=${_}&start_date=${b}&end_date=${Y}`,d=await Z(g.token,B);return{data:d==null?void 0:d.data.map(y=>{const{id:I,user_id:F,patient_id:k,appointment_id:S,payment_transaction_id:Q,amount:C,transaction_type:L,is_wallet_txn:V,notes:W,created_at:q,patient_f_name:T,patient_l_name:O,user_f_name:N,user_l_name:E}=y;return{id:I,patient:k?e.jsx(j,{to:`/patient/${k}`,children:`${T} ${O}`}):"N/A",user:F?e.jsx(j,{to:`/user/${F}`,children:`${N} ${E}`}):"N/A","app ID":e.jsx(j,{to:`/appointment/${S}`,children:S}),"txn ID":Q||"N/A",amount:C,"txn type":ve(L),"wallet Txn":V==1?"Yes":"No",notes:W||"N/A",createdAt:o(q).format("D MMM YY hh:mmA")}}),total_record:d.total_record}},{isLoading:A,data:m,error:R}=ee({queryKey:["transactions",t,_,u],queryFn:M}),z=i=>{r(i)},h=Math.ceil((m==null?void 0:m.total_record)/50);return s.useEffect(()=>{a.current&&a.current.scrollIntoView({behavior:"smooth",block:"start"})},[t]),R&&(v.isActive(D)||v({id:D,title:"Oops!",description:"Something went wrong.",status:"error",duration:2e3,isClosable:!0,position:"top"})),n("ALL_TRANSACTION_VIEW")?e.jsxs(x,{ref:a,children:[A||!m?e.jsxs(x,{children:[e.jsxs(l,{mb:5,justify:"space-between",children:[e.jsx(f,{w:400,h:8}),e.jsx(f,{w:50,h:8})]}),e.jsx(f,{h:300,w:"100%"})]}):e.jsxs(x,{children:[e.jsx(l,{mb:5,justify:"space-between",align:"center",children:e.jsxs(l,{align:"center",gap:4,children:[e.jsx(de,{size:"md",placeholder:"Search",w:400,maxW:"50vw",onChange:i=>w(i.target.value),value:c}),e.jsx(ae,{dateRange:u,setDateRange:$,size:"md"})]})}),e.jsx(se,{data:m==null?void 0:m.data,onActionClick:e.jsx(Ne,{})})]}),e.jsx(l,{justify:"center",mt:4,children:e.jsx(oe,{currentPage:t,onPageChange:z,totalPages:h})})]}):e.jsx(ne,{})}const Ne=({onClick:n,rowData:t})=>e.jsx(l,{justify:"center",children:e.jsx(le,{size:"sm",variant:"ghost",_hover:{background:"none"},onClick:()=>{n(t)},icon:e.jsx(xe,{fontSize:18,color:"blue.500"})})});export{Je as default};
